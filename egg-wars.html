<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÿ≠ÿ±ÿ® ÿßŸÑÿ®Ÿäÿ∂ ü•ö</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #2c3e50;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #8e44ad; /* Void color */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-canvas {
            background: #27ae60; /* Grass */
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .resource-bar {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            display: flex;
            gap: 20px;
            pointer-events: auto;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: bold;
        }

        .shop-btn {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: #f39c12;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            pointer-events: auto;
            box-shadow: 0 4px 0 #d35400;
            transition: transform 0.1s;
        }

        .shop-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .attack-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #e74c3c;
            border: none;
            padding: 20px;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 0 #c0392b;
            pointer-events: auto;
        }

        #shop-modal {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            pointer-events: auto;
            z-index: 100;
            min-width: 300px;
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .buy-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .buy-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .game-status {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: bold;
        }

        .egg-status {
            display: flex;
            gap: 30px;
        }

        .team-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .egg-icon {
            font-size: 24px;
        }

        .egg-broken {
            filter: grayscale(100%);
            opacity: 0.5;
            text-decoration: line-through;
        }

        #waiting-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 200;
        }

        #result-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 300;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }

        #result-title {
            font-size: 60px;
            margin-bottom: 20px;
        }

        #result-emoji {
            font-size: 80px;
            margin-bottom: 30px;
        }

        #result-btn {
            padding: 15px 40px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 20px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Mobile Controls */
        #mobile-controls {
            display: none;
            position: absolute;
            bottom: 30px;
            left: 30px;
            z-index: 100;
            pointer-events: auto;
        }

        .dpad-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            color: white;
            font-size: 24px;
            margin: 5px;
            touch-action: none;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .dpad-btn:active {
            background: rgba(255, 255, 255, 0.5);
        }

        .dpad-row {
            display: flex;
            justify-content: center;
            gap: 60px; /* Space for the center */
        }

        #dpad {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        @media (max-width: 768px) {
            #mobile-controls {
                display: block;
            }

            .shop-btn {
                top: 10px;
                left: 10px;
                bottom: auto;
                padding: 10px 15px;
                font-size: 14px;
            }

            .resource-bar {
                top: 50px; /* Below shop button or status */
                right: 10px;
                bottom: auto;
                flex-direction: column;
                gap: 5px;
                padding: 8px;
                font-size: 14px;
                background: rgba(0,0,0,0.5);
            }

            .attack-btn {
                bottom: 50px;
                right: 30px;
                left: auto;
                transform: none;
                width: 90px;
                height: 90px;
                font-size: 30px;
            }

            .game-status {
                top: 5px;
                padding: 5px 15px;
                font-size: 14px;
                width: 100%;
                box-sizing: border-box;
                display: flex;
                justify-content: center;
                background: transparent;
            }
            
            #game-canvas {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }
        }
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="game-canvas" width="800" height="600"></canvas>

        <div class="ui-layer">
            <div class="game-status">
                <div class="egg-status" id="egg-status-container">
                    <!-- Will be populated by JS -->
                </div>
            </div>

            <div class="resource-bar">
                <div class="resource-item">
                    <i class="fas fa-cube" style="color: #95a5a6;"></i>
                    <span id="iron-count">0</span>
                </div>
                <div class="resource-item">
                    <i class="fas fa-coins" style="color: #f1c40f;"></i>
                    <span id="gold-count">0</span>
                </div>
                <div class="resource-item">
                    <i class="fas fa-gem" style="color: #3498db;"></i>
                    <span id="diamond-count">0</span>
                </div>
                <div class="resource-item">
                    <i class="fas fa-heart" style="color: #e74c3c;"></i>
                    <span id="health-count">100</span>
                </div>
            </div>

            <button class="shop-btn" onclick="toggleShop()">
                <i class="fas fa-shopping-cart"></i> ÿßŸÑŸÖÿ™ÿ¨ÿ± (B)
            </button>
            
            <button class="attack-btn" onclick="attack()">
                <i class="fas fa-gavel"></i>
            </button>

            <!-- Mobile Controls -->
            <div id="mobile-controls">
                <div id="dpad">
                    <button id="btn-up" class="dpad-btn"><i class="fas fa-arrow-up"></i></button>
                    <div class="dpad-row">
                        <button id="btn-left" class="dpad-btn"><i class="fas fa-arrow-left"></i></button>
                        <button id="btn-right" class="dpad-btn"><i class="fas fa-arrow-right"></i></button>
                    </div>
                    <button id="btn-down" class="dpad-btn"><i class="fas fa-arrow-down"></i></button>
                </div>
            </div>
        </div>

        <div id="shop-modal">
            <div class="shop-header">
                <h2>ÿßŸÑŸÖÿ™ÿ¨ÿ±</h2>
                <button onclick="toggleShop()" style="background:none;border:none;font-size:20px;cursor:pointer">&times;</button>
            </div>
            <div id="shop-items">
                <div class="shop-item">
                    <div>
                        <strong>ÿ≥ŸäŸÅ ÿÆÿ¥ÿ®Ÿä</strong>
                        <div style="font-size:12px;color:#666">ÿ∂ÿ±ÿ±: 10</div>
                    </div>
                    <button class="buy-btn" onclick="buyItem('sword_wood', 5, 'iron')">5 ÿ≠ÿØŸäÿØ</button>
                </div>
                <div class="shop-item">
                    <div>
                        <strong>ÿ≥ŸäŸÅ ÿ≠ÿØŸäÿØŸä</strong>
                        <div style="font-size:12px;color:#666">ÿ∂ÿ±ÿ±: 20</div>
                    </div>
                    <button class="buy-btn" onclick="buyItem('sword_iron', 10, 'iron')">10 ÿ≠ÿØŸäÿØ</button>
                </div>
                <div class="shop-item">
                    <div>
                        <strong>ÿ≥ŸäŸÅ ŸÖÿßÿ≥Ÿä</strong>
                        <div style="font-size:12px;color:#666">ÿ∂ÿ±ÿ±: 30</div>
                    </div>
                    <button class="buy-btn" onclick="buyItem('sword_diamond', 5, 'diamond')">5 ŸÖÿßÿ≥</button>
                </div>
                <div class="shop-item">
                    <div>
                        <strong>ÿØÿ±ÿπ ŸÖÿßÿ≥Ÿä</strong>
                        <div style="font-size:12px;color:#666">ÿµÿ≠ÿ© ŸÇÿµŸàŸâ: 200</div>
                    </div>
                    <button class="buy-btn" onclick="buyItem('armor_diamond', 5, 'gold')">5 ÿ∞Ÿáÿ®</button>
                </div>
                <div class="shop-item">
                    <div>
                        <strong>ÿ¥ŸÅÿßÿ°</strong>
                        <div style="font-size:12px;color:#666">ÿßÿ≥ÿ™ÿπÿßÿØÿ© 20 ÿµÿ≠ÿ©</div>
                    </div>
                    <button class="buy-btn" onclick="buyItem('heal', 2, 'gold')">2 ÿ∞Ÿáÿ®</button>
                </div>
            </div>
        </div>

        <div id="avatar-selection" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 400; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;">
            <h1>ÿßÿÆÿ™ÿ± ÿ¥ÿÆÿµŸäÿ™ŸÉ</h1>
            <div style="display: flex; gap: 20px; margin: 30px;">
                <div onclick="selectAvatar('üëÆ')" style="font-size: 60px; cursor: pointer; padding: 20px; border: 2px solid white; border-radius: 10px;">üëÆ</div>
                <div onclick="selectAvatar('ü•∑')" style="font-size: 60px; cursor: pointer; padding: 20px; border: 2px solid white; border-radius: 10px;">ü•∑</div>
                <div onclick="selectAvatar('ü§ñ')" style="font-size: 60px; cursor: pointer; padding: 20px; border: 2px solid white; border-radius: 10px;">ü§ñ</div>
                <div onclick="selectAvatar('üßõ')" style="font-size: 60px; cursor: pointer; padding: 20px; border: 2px solid white; border-radius: 10px;">üßõ</div>
                <div onclick="selectAvatar('üßü')" style="font-size: 60px; cursor: pointer; padding: 20px; border: 2px solid white; border-radius: 10px;">üßü</div>
            </div>
            <p>ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿÆÿµŸäÿ© ŸÑŸÑÿ®ÿØÿ°</p>
        </div>

        <div id="waiting-screen">
            <h1>ÿ¨ÿßÿ±Ÿä ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿÆÿµŸÖ...</h1>
            <div class="spinner"><i class="fas fa-spinner fa-spin fa-3x"></i></div>
            <button onclick="forceStartGame()" style="margin-top: 20px; padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer;">
                ÿ™ÿ¨ÿ±ÿ®ÿ© ÿßŸÑŸÑÿπÿ® (ÿ®ÿØŸàŸÜ ÿÆÿµŸÖ)
            </button>
        </div>

        <div id="result-screen" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 300; flex-direction: column; justify-content: center; align-items: center; color: white;">
            <h1 id="result-title" style="font-size: 60px; margin-bottom: 20px;"></h1>
            <div id="result-emoji" style="font-size: 80px; margin-bottom: 30px;"></div>
            <button onclick="window.location.href='index.html'" style="padding: 15px 40px; background: #3498db; color: white; border: none; border-radius: 25px; font-size: 20px; cursor: pointer; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
                <i class="fas fa-home"></i> ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
            </button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-auth.js"></script>
    <script src="firebase-data.js"></script>
    <script src="egg-wars.js"></script>
</body>
</html>