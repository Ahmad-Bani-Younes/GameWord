<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>๐ฏ ุญููุงู ุฌูุงุฏ ูุจุงุช</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            margin: 0;
        }

        .game-box {
            width: 100%;
            max-width: 700px;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        h2 {
            margin-bottom: 10px;
            color: #f5576c;
            font-size: 28px;
        }

        .players-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .player {
            text-align: center;
            flex: 1;
        }

        .player-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .player-score {
            font-size: 20px;
            font-weight: bold;
            color: #f5576c;
            margin: 5px 0;
        }

        .player-status {
            font-size: 12px;
            color: #666;
        }

        .round-indicator {
            background: #6c757d;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 15px;
        }

        .challenge-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            color: white;
        }

        .letter {
            font-size: 80px;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .category {
            font-size: 24px;
            margin-top: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .input-group {
            text-align: right;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
            transition: all 0.3s;
        }

        input:focus {
            border-color: #f5576c;
            box-shadow: 0 0 0 3px rgba(245, 87, 108, 0.1);
        }

        input:disabled {
            background: #f0f0f0;
            cursor: not-allowed;
        }

        button {
            margin-top: 15px;
            width: 100%;
            padding: 15px;
            background: #f5576c;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover:not(:disabled) {
            background: #e04658;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: #888;
            margin-top: 10px;
        }

        button.secondary:hover {
            background: #666;
        }

        button.danger {
            background: #dc3545;
            margin-top: 10px;
        }

        button.danger:hover {
            background: #c82333;
        }

        .result-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: right;
        }

        .result-item {
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-item.correct {
            background: #d4edda;
            color: #155724;
        }

        .result-item.wrong {
            background: #f8d7da;
            color: #721c24;
        }

        .result-item.empty {
            background: #fff3cd;
            color: #856404;
        }

        .winner {
            font-size: 24px;
            margin-top: 15px;
            font-weight: bold;
            padding: 15px;
            border-radius: 8px;
        }

        .winner.win {
            color: #28a745;
            background: #d4edda;
        }

        .winner.lose {
            color: #dc3545;
            background: #f8d7da;
        }

        .winner.draw {
            color: #ffc107;
            background: #fff3cd;
        }

        .game-over {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #f5576c;
        }

        .game-over h3 {
            color: #f5576c;
            margin-bottom: 15px;
        }

        .final-result {
            font-size: 32px;
            font-weight: bold;
            margin: 15px 0;
        }

        .final-result.win {
            color: #28a745;
        }

        .final-result.lose {
            color: #dc3545;
        }

        .final-result.draw {
            color: #ffc107;
        }

        @media (max-width: 600px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

<div class="game-box">
    <h2>๐ฏ ุญููุงู ุฌูุงุฏ ูุจุงุช</h2>

    <div class="round-indicator" id="roundIndicator">ุงูุฌููุฉ 1 / 5</div>

    <div class="players-info">
        <div class="player">
            <div class="player-name" id="myName">ุฃูุง</div>
            <div class="player-score" id="myScore">0</div>
            <div class="player-status" id="myStatus">ุฌุงูุฒ</div>
        </div>
        <div class="player">
            <div class="player-name" id="opponentName">ุงูุฎุตู</div>
            <div class="player-score" id="opponentScore">0</div>
            <div class="player-status" id="opponentStatus">ุจุงูุชุธุงุฑ...</div>
        </div>
    </div>

    <div id="gameArea">
        <div class="challenge-box">
            <div class="letter" id="letterBox">ุ</div>
            <div class="category" id="categoryBox">ุงูุชุธุฑ...</div>
        </div>

        <div class="form-grid">
            <div class="input-group">
                <label>๐ฆ ุงุณู ููุฏ</label>
                <input type="text" id="boyName" placeholder="ูุซุงู: ุฃุญูุฏ">
            </div>
            <div class="input-group">
                <label>๐ง ุงุณู ุจูุช</label>
                <input type="text" id="girlName" placeholder="ูุซุงู: ุขูุฉ">
            </div>
            <div class="input-group">
                <label>๐ฆ ุญููุงู</label>
                <input type="text" id="animal" placeholder="ูุซุงู: ุฃุณุฏ">
            </div>
            <div class="input-group">
                <label>๐ณ ูุจุงุช</label>
                <input type="text" id="plant" placeholder="ูุซุงู: ุฃุฑุฒ">
            </div>
            <div class="input-group">
                <label>๐บ ุฌูุงุฏ</label>
                <input type="text" id="object" placeholder="ูุซุงู: ุฅุจุฑุฉ">
            </div>
            <div class="input-group">
                <label>๐ ุจูุงุฏ</label>
                <input type="text" id="country" placeholder="ูุซุงู: ุงูุฃุฑุฏู">
            </div>
        </div>

        <button id="submitBtn" onclick="sendAnswers()">ุฅุฑุณุงู ุงูุฅุฌุงุจุงุช</button>

        <div id="resultBox" style="display:none;"></div>
        <div class="winner" id="winnerBox" style="display:none;"></div>
    </div>

    <div id="gameOverBox" class="game-over" style="display:none;">
        <h3>๐ ุงูุชูุช ุงููุนุจุฉ!</h3>
        <div class="final-score">
            <div><strong id="myFinalName">ุฃูุช</strong>: <span id="myFinalScore">0</span></div>
            <div><strong id="opFinalName">ุงูุฎุตู</strong>: <span id="opFinalScore">0</span></div>
        </div>
        <div class="final-result" id="finalResult"></div>
    </div>

    <button class="danger" id="endGameBtn" onclick="endGame()">ุฅููุงุก ุงููุนุจุฉ</button>
    <button class="secondary" onclick="location.href='index.html'">ุฑุฌูุน ููุตูุญุฉ ุงูุฑุฆูุณูุฉ</button>
</div>

<!-- ๐ฅ Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-auth.js"></script>

<!-- ๐ฅ ููู firebase-data.js ุงููู ููู ุงูุฏูุงู -->
<script src="firebase-data.js"></script>

<script>

// ๐ฅ ุงูุชูุงูู ูุน Firebase - ูุง ูุณุชุฎุฏู API_URL ุจุนุฏ ุงูุขู
const MAX_ROUNDS = 5;

// ุงูุญุฑูู ุงูุนุฑุจูุฉ
const ARABIC_LETTERS = ['ุง', 'ุจ', 'ุช', 'ุซ', 'ุฌ', 'ุญ', 'ุฎ', 'ุฏ', 'ุฐ', 'ุฑ', 'ุฒ', 'ุณ', 'ุด', 'ุต', 'ุถ', 'ุท', 'ุธ', 'ุน', 'ุบ', 'ู', 'ู', 'ู', 'ู', 'ู', 'ู', 'ู', 'ู', 'ู'];

// ูุงุนุฏุฉ ุจูุงูุงุช ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ - ุดุงููุฉ
const VALID_ANSWERS = {
    'ุง': {
        boyNames: ['ุฃุญูุฏ', 'ุฃููุฑ', 'ุฃููู', 'ุฅุจุฑุงููู', 'ุฅุณูุงู', 'ุฃุณุงูุฉ', 'ุฃูุณ', 'ุฅูุงุฏ', 'ุฃุฏูู', 'ุฅุณูุงุนูู', 'ุฃุฏูุจ', 'ุฃุฑูุงู', 'ุฅููุงุณ', 'ุฃูุฌุฏ'],
        girlNames: ['ุขูุฉ', 'ุฃูู', 'ุฅููุงู', 'ุฃุณูุงุก', 'ุขูุงุก', 'ุฃููุฑุฉ', 'ุฅุณุฑุงุก', 'ุฃุฑูุฌ', 'ุฅููุงุณ', 'ุฃููู', 'ุขููุฉ', 'ุฃูููุฉ', 'ุฅููุงู', 'ุฃููุงู'],
        animals: ['ุฃุณุฏ', 'ุฃุฑูุจ', 'ุฅูุฒุฉ', 'ุฃูุนู', 'ุฃุฎุทุจูุท'],
        plants: ['ุฃุฑุฒ', 'ุฃูุงูุงุณ', 'ุฅุฌุงุต'],
        objects: ['ุฅุจุฑุฉ', 'ุฃุฑููุฉ', 'ุฃุตูุต', 'ุฅูุงุก', 'ุฅุทุงุฑ'],
        countries: ['ุงูุฃุฑุฏู', 'ุงูุฅูุงุฑุงุช', 'ุฃูุฑููุง', 'ุฅุณุจุงููุง', 'ุฅูุทุงููุง', 'ุฃุณุชุฑุงููุง', 'ุฃููุงููุง', 'ุฃูุบุงูุณุชุงู', 'ุฅูุฑุงู', 'ุฃููุฑุงููุง', 'ุฃูุบูุฏุง', 'ุฅุซููุจูุง']
    },
    'ุจ': {
        boyNames: ['ุจูุงู', 'ุจุงุณู', 'ุจุดุงุฑ', 'ุจุฏุฑ', 'ุจุงุณู', 'ุจูุฑ', 'ุจุฑุงุก', 'ุจูุงุก'],
        girlNames: ['ุจุชูู', 'ุจุณูุฉ', 'ุจุดุฑู', 'ุจูุงู', 'ุจูููุณ', 'ุจุฏูุฑ', 'ุจุณูุช', 'ุจูุณุงู'],
        animals: ['ุจูุฑุฉ', 'ุจุทุฉ', 'ุจุจุบุงุก', 'ุจุนูุถุฉ', 'ุจุฌุนุฉ', 'ุจููุฉ', 'ุจุบู'],
        plants: ['ุจุทุงุทุณ', 'ุจุตู', 'ุจูุฏููุณ', 'ุจุฑุชูุงู', 'ุจุทูุฎ', 'ุจุฑููู', 'ุจุงููุฉ', 'ุจุฑูููู', 'ุจูุฏูุฑุฉ'],
        objects: ['ุจุงุจ', 'ุจุทุงููุฉ', 'ุจุฑููู', 'ุจูุฏููุฉ', 'ุจูุตูุฉ', 'ุจุงููู', 'ุจุฑุงุฏ', 'ุจุทุงูุฉ'],
        countries: ['ุจุฑูุทุงููุง', 'ุจูุฌููุง', 'ุงูุจุญุฑูู', 'ุจูุบูุงุฏูุด', 'ุจูููุฏุง', 'ุงูุจุฑุงุฒูู', 'ุจูุบุงุฑูุง', 'ุจูููููุง']
    },
    'ุช': {
        boyNames: ['ุชุงูุฑ', 'ุชูู', 'ุชูููู', 'ุชููู', 'ุชุฑูู'],
        girlNames: ['ุชุงูุง', 'ุชูุงุฑุง', 'ุชุณููู', 'ุชูู', 'ุชุงูุฉ', 'ุชุบุฑูุฏ', 'ุชููุงุก'],
        animals: ['ุชูุณุงุญ', 'ุชูุณ', 'ุชุฑุณุฉ'],
        plants: ['ุชูุงุญ', 'ุชูุช', 'ุชูู', 'ุชูุฑ'],
        objects: ['ุชููุงุฒ', 'ุชูููู', 'ุชุงุฌ', 'ุชููุฑุฉ', 'ุชุฑูุณ', 'ุชุงุจูุช'],
        countries: ['ุชููุณ', 'ุชุฑููุง', 'ุชุงููุงูุฏ', 'ุชูุฒุงููุง', 'ุชุดููู']
    },
    'ุซ': {
        boyNames: ['ุซุงุฆุฑ', 'ุซุงุจุช', 'ุซุงูุฑ'],
        girlNames: ['ุซุฑูุง', 'ุซูุงุก', 'ุซุฑุงุก'],
        animals: ['ุซุนุจุงู', 'ุซุนูุจ', 'ุซูุฑ'],
        plants: ['ุซูู', 'ุซูุงู'],
        objects: ['ุซูุงุฌุฉ', 'ุซูุจ', 'ุซุฑูุง'],
        countries: []
    },
    'ุฌ': {
        boyNames: ['ุฌูุงู', 'ุฌูุงู', 'ุฌุงุจุฑ', 'ุฌุงุณู', 'ุฌููู', 'ุฌูุงุฏ', 'ุฌุนูุฑ', 'ุฌุงุฏ'],
        girlNames: ['ุฌูู', 'ุฌูุฏ', 'ุฌูุฑู', 'ุฌูููุฉ', 'ุฌูุงู', 'ุฌููู', 'ุฌููุงู', 'ุฌูุงูุฉ'],
        animals: ['ุฌูู', 'ุฌุงููุณ', 'ุฌุฑุงุฏ', 'ุฌุฑุฐ'],
        plants: ['ุฌุฒุฑ', 'ุฌุฑุฌูุฑ', 'ุฌูุงูุฉ', 'ุฌูุฒ ููุฏ'],
        objects: ['ุฌูุงู', 'ุฌุฑุณ', 'ุฌุฏุงุฑ', 'ุฌูุงุฒ', 'ุฌุฒูุฉ', 'ุฌูุงุฑุจ'],
        countries: ['ุงูุฌุฒุงุฆุฑ', 'ุฌูุจูุชู', 'ุฌูุฑุฌูุง', 'ุฌุงูุงููุง']
    },
    'ุญ': {
        boyNames: ['ุญุณู', 'ุญุณูู', 'ุญูุฒุฉ', 'ุญุณุงู', 'ุญุงุชู', 'ุญุฐููุฉ', 'ุญุงุฑุซ', 'ุญููู'],
        girlNames: ['ุญูุงู', 'ุญูุง', 'ุญููู', 'ุญูุฑูุฉ', 'ุญุณูุงุก', 'ุญูุงุฉ', 'ุญุจูุจุฉ', 'ุญููุฏุฉ'],
        animals: ['ุญุตุงู', 'ุญูุงุฑ', 'ุญูุงูุฉ', 'ุญูุช', 'ุญูุฒูู', 'ุญุฑุจุงุก', 'ุญุดุฑุฉ'],
        plants: ['ุญูุต', 'ุญูุทุฉ'],
        objects: ['ุญุฐุงุก', 'ุญููุจุฉ', 'ุญุจู', 'ุญุฒุงู', 'ุญุฌุฑ', 'ุญูู'],
        countries: []
    },
    'ุฎ': {
        boyNames: ['ุฎุงูุฏ', 'ุฎููู', 'ุฎุถุฑ', 'ุฎูููุฉ', 'ุฎุทุงุจ'],
        girlNames: ['ุฎุฏูุฌุฉ', 'ุฎููุฉ', 'ุฎููุฏ', 'ุฎูุฑูุฉ'],
        animals: ['ุฎุฑูู', 'ุฎูุฒูุฑ', 'ุฎูุงุด', 'ุฎูู'],
        plants: ['ุฎุณ', 'ุฎูุงุฑ', 'ุฎูุฎ', 'ุฎุจูุฒุฉ'],
        objects: ['ุฎุงุชู', 'ุฎูุท', 'ุฎุฑูุทุฉ', 'ุฎุฒุงูุฉ', 'ุฎููุฉ'],
        countries: []
    },
    'ุฏ': {
        boyNames: ['ุฏุงูุฏ', 'ุฏุงููุงู', 'ุฏูุจ', 'ุฏุฑููุด'],
        girlNames: ['ุฏุงูุฉ', 'ุฏููุง', 'ุฏููุง', 'ุฏุนุงุก', 'ุฏูุงูุง', 'ุฏูุงู', 'ุฏุงุฑูู'],
        animals: ['ุฏุฌุงุฌุฉ', 'ุฏูู', 'ุฏุจ', 'ุฏููููู', 'ุฏูุฏุฉ'],
        plants: ['ุฏุฑุงู', 'ุฏูู', 'ุฏูุงุฑ ุงูุดูุณ'],
        objects: ['ุฏูุชุฑ', 'ุฏุฑุฌ', 'ุฏููุงุจ', 'ุฏุจูุณ', 'ุฏุฑุงุฌุฉ'],
        countries: ['ุฏุจู', 'ุงูุฏููุงุฑู']
    },
    'ุฐ': {
        boyNames: ['ุฐูุงุจ', 'ุฐูู'],
        girlNames: ['ุฐูุฑู'],
        animals: ['ุฐุฆุจ', 'ุฐุจุงุจุฉ'],
        plants: ['ุฐุฑุฉ'],
        objects: ['ุฐูุจ'],
        countries: []
    },
    'ุฑ': {
        boyNames: ['ุฑุงูู', 'ุฑุงุดุฏ', 'ุฑุถุง', 'ุฑูุงุถ', 'ุฑุงุฆุฏ', 'ุฑุดูุฏ', 'ุฑุงูุช', 'ุฑุจูุน'],
        girlNames: ['ุฑูุง', 'ุฑูู', 'ุฑูู', 'ุฑูุงู', 'ุฑุบุฏ', 'ุฑููู', 'ุฑุจุงุจ', 'ุฑุดุง', 'ุฑูุฒ', 'ุฑุงููุง'],
        animals: ['ุฑุฎู', 'ุฑูู'],
        plants: ['ุฑูุงู', 'ุฑูุฒูุงุฑู', 'ุฑูุญุงู'],
        objects: ['ุฑุงุฏูู', 'ุฑู', 'ุฑูุญ', 'ุฑูููุช'],
        countries: ['ุฑูุณูุง', 'ุฑููุงููุง', 'ุฑูุงูุฏุง']
    },
    'ุฒ': {
        boyNames: ['ุฒูุฏ', 'ุฒูุงุฏ', 'ุฒุงูุฑ', 'ุฒูุฑูุง', 'ุฒูู', 'ุฒุงูู'],
        girlNames: ['ุฒููุจ', 'ุฒูุฑุงุก', 'ุฒููุฉ', 'ุฒูุฑุฉ', 'ุฒูู', 'ุฒูุฒู'],
        animals: ['ุฒุฑุงูุฉ', 'ุฒูุงุญู', 'ุฒูุจุฑุง'],
        plants: ['ุฒูุชูู', 'ุฒูุฌุจูู', 'ุฒุนุชุฑ', 'ุฒูุฑุฉ'],
        objects: ['ุฒุฌุงุฌ', 'ุฒุฑ', 'ุฒุฌุงุฌุฉ', 'ุฒูุฑู'],
        countries: ['ุฒููุจุงุจูู', 'ุฒุงูุจูุง']
    },
    'ุณ': {
        boyNames: ['ุณุงูู', 'ุณุนูุฏ', 'ุณุงูู', 'ุณููู', 'ุณูุทุงู', 'ุณุนุฏ', 'ุณูููุงู', 'ุณุงูุฑ', 'ุณููุงู'],
        girlNames: ['ุณุงุฑุฉ', 'ุณููู', 'ุณูุงุก', 'ุณููุฉ', 'ุณูุณุจูู', 'ุณูุง', 'ุณูุฑ', 'ุณููุฑ', 'ุณูู'],
        animals: ['ุณููุฉ', 'ุณูุญูุงุฉ', 'ุณูุฌุงุจ', 'ุณูุงู', 'ุณุญููุฉ', 'ุณุฑุทุงู'],
        plants: ['ุณุจุงูุฎ', 'ุณูุฑุฌู', 'ุณูุงู'],
        objects: ['ุณุฑูุฑ', 'ุณูุงุฑุฉ', 'ุณุงุนุฉ', 'ุณุฌุงุฏุฉ', 'ุณูู', 'ุณููู', 'ุณูููุฉ', 'ุณูุฉ'],
        countries: ['ุณูุฑูุง', 'ุงูุณุนูุฏูุฉ', 'ุงูุณูุฏุงู', 'ุณูุบุงููุฑุฉ', 'ุณููุณุฑุง', 'ุงูุณููุฏ', 'ุณุฑููุงููุง']
    },
    'ุด': {
        boyNames: ['ุดุงุฏู', 'ุดุงูุฑ', 'ุดุฑูู', 'ุดูุฑู', 'ุดูุงุจ'],
        girlNames: ['ุดููุงุก', 'ุดุฐู', 'ุดูุฏ', 'ุดูุฑูู', 'ุดุฑูู', 'ุดุงุฏูุฉ'],
        animals: ['ุดูุจุงูุฒู', 'ุดุงููู'],
        plants: ['ุดูุงู', 'ุดุนูุฑ', 'ุดุงู'],
        objects: ['ุดุจุงู', 'ุดูุทุฉ', 'ุดูุน', 'ุดูุงุนุฉ', 'ุดุฑุงุจ'],
        countries: []
    },
    'ุต': {
        boyNames: ['ุตุงูุญ', 'ุตูุงุญ', 'ุตููุจ', 'ุตุงุฏู', 'ุตุจุญู', 'ุตููุงู'],
        girlNames: ['ุตูุงุก', 'ุตุงุจุฑูู', 'ุตููุฉ', 'ุตุจุง'],
        animals: ['ุตูุฑ', 'ุตุฑุตูุฑ'],
        plants: ['ุตุจุงุฑ', 'ุตููุจุฑ'],
        objects: ['ุตูุฏูู', 'ุตุญู', 'ุตุงุจูู', 'ุตูุฑุฉ'],
        countries: ['ุงูุตูู', 'ุงูุตููุงู']
    },
    'ุถ': {
        boyNames: ['ุถูุงุก', 'ุถุงุฑู', 'ุถุฑุบุงู'],
        girlNames: ['ุถุญู', 'ุถู'],
        animals: ['ุถุจุน', 'ุถูุฏุน'],
        plants: [],
        objects: ['ุถูุก'],
        countries: []
    },
    'ุท': {
        boyNames: ['ุทุงุฑู', 'ุทูุงู', 'ุทุงูุฑ', 'ุทู'],
        girlNames: ['ุทูู', 'ุทูุจุฉ'],
        animals: ['ุทุงููุณ'],
        plants: ['ุทูุงุทู', 'ุทุญุงูุจ'],
        objects: ['ุทุงููุฉ', 'ุทุงุฆุฑุฉ', 'ุทุจู', 'ุทูุจ'],
        countries: []
    },
    'ุธ': {
        boyNames: ['ุธุงูุฑ'],
        girlNames: [],
        animals: ['ุธุจู'],
        plants: [],
        objects: ['ุธุฑู'],
        countries: []
    },
    'ุน': {
        boyNames: ['ุนูุฑ', 'ุนูู', 'ุนุจุฏุงููู', 'ุนุซูุงู', 'ุนุงูุฑ', 'ุนุฏูุงู', 'ุนูุงุฏ', 'ุนุตุงู', 'ุนุฒูุฒ'],
        girlNames: ['ุนุงุฆุดุฉ', 'ุนูุง', 'ุนุจูุฑ', 'ุนูุฏ', 'ุนูุงู', 'ุนุฒุฉ', 'ุนููุฏ', 'ุนุงููุฉ'],
        animals: ['ุนุตููุฑ', 'ุนูุฑุจ', 'ุนููุจูุช', 'ุนุฌู'],
        plants: ['ุนูุจ', 'ุนุฏุณ', 'ุนุฑุนุฑ'],
        objects: ['ุนุตุง', 'ุนูุฏ', 'ุนูู', 'ุนุฌูุฉ'],
        countries: ['ุนูุงู', 'ุงูุนุฑุงู']
    },
    'ุบ': {
        boyNames: ['ุบุณุงู', 'ุบุงุฒู', 'ุบุงูุจ', 'ุบูุซ'],
        girlNames: ['ุบุงุฏุฉ', 'ุบุงููุฉ', 'ุบูุฏุงุก', 'ุบุฒู'],
        animals: ['ุบุฑุงุจ', 'ุบุฒุงู', 'ุบูุฑููุง'],
        plants: ['ุบุงุฑ'],
        objects: ['ุบุทุงุก', 'ุบุฑูุฉ'],
        countries: ['ุบุงูุง', 'ุบูุงุชููุงูุง', 'ุบูููุง']
    },
    'ู': {
        boyNames: ['ูุงุฑุณ', 'ููุฏ', 'ููุตู', 'ูุฑุงุณ', 'ูุงุฏู', 'ููุงุฒ', 'ูุคุงุฏ'],
        girlNames: ['ูุงุทูุฉ', 'ูุฑุญ', 'ูุฑูุฏุฉ', 'ูุงูุฒุฉ', 'ูุฏูู', 'ูุฏุงุก'],
        animals: ['ููู', 'ููุฏ', 'ูุฃุฑ', 'ูุฑุงุดุฉ'],
        plants: ['ููู', 'ูุฌู', 'ูุณุชู', 'ูุฑุงููุฉ'],
        objects: ['ูุฑู', 'ูุฑุดุงุฉ', 'ูุงููุณ', 'ูุฃุณ'],
        countries: ['ููุณุทูู', 'ูุฑูุณุง', 'ููููุฏุง', 'ุงูููุจูู', 'ููุฒูููุง']
    },
    'ู': {
        boyNames: ['ูุงุณู', 'ูุตู', 'ููุณ', 'ูุชูุจุฉ'],
        girlNames: ['ููุฑ'],
        animals: ['ูุฑุฏ', 'ูุท', 'ูููุฐ', 'ููุฏูู'],
        plants: ['ููุญ', 'ูุฑูุจูุท', 'ูุฑุน'],
        objects: ['ููู', 'ูููุต', 'ููู', 'ูุจุนุฉ', 'ูุงุฑุจ'],
        countries: ['ูุทุฑ', 'ูุจุฑุต']
    },
    'ู': {
        boyNames: ['ูุฑูู', 'ููุงู', 'ูุฑู', 'ูุงูู'],
        girlNames: ['ูุฑููุฉ', 'ููุซุฑ', 'ูุงููููุง'],
        animals: ['ููุจ', 'ููุบุฑ', 'ููุงูุง'],
        plants: ['ูุฑุฒ', 'ูุฑุงุซ', 'ููุซุฑู', 'ูุฒุจุฑุฉ', 'ูููู'],
        objects: ['ูุชุงุจ', 'ูุฑุณู', 'ููุจ', 'ูุฑุฉ'],
        countries: ['ุงููููุช', 'ููุฏุง', 'ููุฑูุง', 'ูููููุจูุง', 'ููููุง']
    },
    'ู': {
        boyNames: ['ููุซ', 'ูุคู', 'ูููุงู'],
        girlNames: ['ูููู', 'ูููุง', 'ููู', 'ูุงุฑุง', 'ูุจูู', 'ูุทููุฉ', 'ูุฌูู'],
        animals: ['ููุซ', 'ูุงูุง'],
        plants: ['ููููู', 'ููุฒ', 'ููุจูุง'],
        objects: ['ููุจุฉ', 'ููุญุฉ'],
        countries: ['ูุจูุงู', 'ููุจูุง', 'ูููุณูุจูุฑุบ']
    },
    'ู': {
        boyNames: ['ูุญูุฏ', 'ูุญููุฏ', 'ูุตุทูู', 'ูุนุงุฐ', 'ูุงูู', 'ูุฑุงุฏ', 'ูุฑูุงู', 'ูููุฏ', 'ูุงุฌุฏ', 'ูููุฑ'],
        girlNames: ['ูุฑูู', 'ููู', 'ููู', 'ููุฑุง', 'ูุงุฑูุง', 'ููุง', 'ููุณ', 'ูุฑุงู', 'ูู', 'ููุงู'],
        animals: ['ูุงุนุฒ', 'ููุง', 'ูุงููุซ'],
        plants: ['ููุฒ', 'ูุงูุฌู', 'ูููุฎูุฉ', 'ููููู', 'ูุดูุด'],
        objects: ['ููุชุงุญ', 'ููุชุจ', 'ูุฑูุญุฉ', 'ููุนูุฉ', 'ููุต', 'ูุตุจุงุญ', 'ูุฑุขุฉ'],
        countries: ['ูุตุฑ', 'ุงููุบุฑุจ', 'ูุงููุฒูุง', 'ุงูููุณูู', 'ููุฑูุชุงููุง']
    },
    'ู': {
        boyNames: ['ูุงุฏุฑ', 'ูุงุตุฑ', 'ูุจูู', 'ููุงู', 'ูุงูู', 'ูุฒุงุฑ'],
        girlNames: ['ููุฑ', 'ูุงุฏูุฉ', 'ููู', 'ูุฌูุงุก', 'ูุฌูู', 'ูุณุฑูู', 'ูุฑููู', 'ูุงุฏูุง'],
        animals: ['ููุฑ', 'ูุญูุฉ', 'ูุนุงูุฉ', 'ูุณุฑ', 'ููู'],
        plants: ['ูุนูุงุน', 'ูุฑุฌุณ'],
        objects: ['ูุงูุฐุฉ', 'ูุธุงุฑุฉ', 'ูุฌูุฉ'],
        countries: ['ุงููุฑููุฌ', 'ููุฌูุฑูุง', 'ูููุฒูููุฏุง', 'ุงูููุณุง', 'ููุจุงู']
    },
    'ู': {
        boyNames: ['ูุงูู', 'ูุดุงู', 'ููุซู', 'ูุงุฏู', 'ููุงู'],
        girlNames: ['ูุงูุฉ', 'ูุจุฉ', 'ูุฏู', 'ููุฏ', 'ููุงุฏู', 'ููุง', 'ูููุงุก'],
        animals: ['ูุฑ', 'ูุฏูุฏ'],
        plants: ['ููู'],
        objects: ['ูุงุชู'],
        countries: ['ููููุฏุง', 'ุงูููุฏ', 'ูููุบ ูููุบ']
    },
    'ู': {
        boyNames: ['ูุงุฆู', 'ูููุฏ', 'ูุณุงู', 'ูุณูู'],
        girlNames: ['ููุงุก', 'ูุฑุฏ', 'ูุนุฏ', 'ูุณู', 'ูุฏุงุฏ'],
        animals: ['ูุนู', 'ูุฒุฉ', 'ูุทูุงุท'],
        plants: ['ูุฑุฏ'],
        objects: ['ูุณุงุฏุฉ'],
        countries: []
    },
    'ู': {
        boyNames: ['ูุงุณุฑ', 'ููุณู', 'ูุฒู', 'ูุงูู', 'ูุฒูุฏ', 'ูุงุณูู', 'ูุญูู'],
        girlNames: ['ูุงุณููู', 'ูุงุฑุง', 'ูุณุฑู', 'ูููู', 'ูุณุฑ'],
        animals: ['ููุงูุฉ', 'ูุนุณูุจ'],
        plants: ['ููุณูู', 'ูุงุณููู'],
        objects: ['ูุงูุฉ'],
        countries: ['ุงูููู', 'ุงููุงุจุงู', 'ููุบูุณูุงููุง']
    }
};

let me = JSON.parse(localStorage.getItem("user"));
if (!me) location.href = "login.html";

let params = new URLSearchParams(location.search);
let opponentId = String(params.get("op"));
let gameId = params.get("game");

let gameRef = firebase.database().ref('word-games/' + gameId);
let gameData = null;
let isHost = String(me.id) < String(opponentId); // ุชุญุฏูุฏ ุงููุถูู (ุงูุฃูู ID)

// =========================================
// ๐ฅ ุชููุฆุฉ ุงููุนุจุฉ
// =========================================
function initGame() {
    gameRef.on('value', snapshot => {
        gameData = snapshot.val();

        if (!gameData) {
            // ุฅุฐุง ุงููุนุจุฉ ุบูุฑ ููุฌูุฏุฉุ ูู ุจุฅูุดุงุฆูุง (ูููุฑุฉ ุงูุฃููู)
            if (isHost) {
                createGame();
            }
            return;
        }

        updateUI();
        checkGameLogic();
    });

    // ุฌูุจ ุงุณู ุงูุฎุตู
    getUser(opponentId).then(user => {
        $("#opponentName").text(user.username);
        $("#opFinalName").text(user.username);
    });
}

function createGame() {
    let initialGame = {
        players: {
            [me.id]: { username: me.username, score: 0 },
            [opponentId]: { username: "ุงูุฎุตู", score: 0 } // ุณูุชู ุชุญุฏูุซ ุงูุงุณู ูุงุญูุงู
        },
        round: 1,
        maxRounds: MAX_ROUNDS,
        status: 'playing',
        roundStatus: 'playing', // playing, finished
        challenge: generateChallenge(),
        answers: {}
    };
    gameRef.set(initialGame);
}

// =========================================
// ๐ฎ ุชุญุฏูุซ ุงููุงุฌูุฉ
// =========================================
function updateUI() {
    if (!gameData) return;

    // ุชุญุฏูุซ ุงูููุงุท
    let myScore = gameData.players[me.id]?.score || 0;
    let opScore = gameData.players[opponentId]?.score || 0;
    
    $("#myScore").text(myScore);
    $("#opponentScore").text(opScore);
    $("#myName").text(me.username);

    // ุชุญุฏูุซ ุงูุฌููุฉ
    $("#roundIndicator").text(`ุงูุฌููุฉ ${gameData.round} / ${gameData.maxRounds}`);

    // ุชุญุฏูุซ ุงูุชุญุฏู
    if (gameData.challenge) {
        $("#letterBox").text(gameData.challenge.letter);
        $("#categoryBox").text(gameData.challenge.category);
    }

    // ุญุงูุฉ ุงูุฎุตู
    if (gameData.answers && gameData.answers[opponentId]) {
        $("#opponentStatus").html("โ ุฃุฑุณู");
    } else {
        $("#opponentStatus").html("โณ ููุชุธุฑ...");
    }

    // ุญุงูุชู
    if (gameData.answers && gameData.answers[me.id]) {
        $("#myStatus").html("โ ุฃุฑุณูุช");
        disableInputs(true);
    } else {
        $("#myStatus").html("โณ ุฌุงุฑู ุงููุชุงุจุฉ...");
        disableInputs(false);
    }

    // ุนุฑุถ ุงููุชุงุฆุฌ ุฅุฐุง ุงูุชูุช ุงูุฌููุฉ
    if (gameData.roundStatus === 'finished') {
        showRoundResults();
    } else {
        $("#resultBox").hide();
        $("#winnerBox").hide();
    }

    // ุฅููุงุก ุงููุนุจุฉ
    if (gameData.status === 'finished') {
        showGameOver();
    }
}

function disableInputs(disabled) {
    $("input").prop("disabled", disabled);
    $("#submitBtn").prop("disabled", disabled);
}

// =========================================
// ๐ง ููุทู ุงููุนุจุฉ
// =========================================
function checkGameLogic() {
    if (!isHost || !gameData || gameData.status === 'finished') return;

    // ุงูุชุญูู ูู ุงูุชูุงุก ุงูุฌููุฉ (ููุง ุงููุงุนุจูู ุฃุฌุงุจ)
    if (gameData.roundStatus === 'playing') {
        let p1Answer = gameData.answers && gameData.answers[me.id];
        let p2Answer = gameData.answers && gameData.answers[opponentId];

        if (p1Answer && p2Answer) {
            calculateScores();
        }
    }
}

// =========================================
// ๐ ุฅุฑุณุงู ุงูุฅุฌุงุจุงุช
// =========================================
function sendAnswers() {
    if (gameData.answers && gameData.answers[me.id]) return;

    let answers = {
        boyName: $("#boyName").val().trim(),
        girlName: $("#girlName").val().trim(),
        animal: $("#animal").val().trim(),
        plant: $("#plant").val().trim(),
        object: $("#object").val().trim(),
        country: $("#country").val().trim(),
        time: Date.now()
    };

    gameRef.child('answers').child(me.id).set(answers);
}

// =========================================
// ๐งฎ ุญุณุงุจ ุงููุชุงุฆุฌ (ูููุถูู ููุท)
// =========================================
function calculateScores() {
    let p1Ans = gameData.answers[me.id];
    let p2Ans = gameData.answers[opponentId];
    let letter = gameData.challenge.letter;

    let p1Points = 0;
    let p2Points = 0;

    const categories = [
        { key: 'boyName', type: 'boyNames' },
        { key: 'girlName', type: 'girlNames' },
        { key: 'animal', type: 'animals' },
        { key: 'plant', type: 'plants' },
        { key: 'object', type: 'objects' },
        { key: 'country', type: 'countries' }
    ];

    categories.forEach(cat => {
        let v1 = checkAnswer(letter, p1Ans[cat.key], cat.type);
        let v2 = checkAnswer(letter, p2Ans[cat.key], cat.type);

        if (v1 && v2) {
            p1Points += 5;
            p2Points += 5;
        } else if (v1) {
            p1Points += 10;
        } else if (v2) {
            p2Points += 10;
        }
    });

    // ุจููุต ุงูุณุฑุนุฉ
    if (p1Points > 0 && p2Points > 0) {
        if (p1Ans.time < p2Ans.time) p1Points += 5;
        else if (p2Ans.time < p1Ans.time) p2Points += 5;
    }

    // ุชุญุฏูุซ ุงูููุงุท ูุงูุญุงูุฉ
    let updates = {};
    updates[`players/${me.id}/score`] = (gameData.players[me.id].score || 0) + p1Points;
    updates[`players/${opponentId}/score`] = (gameData.players[opponentId].score || 0) + p2Points;
    updates['roundStatus'] = 'finished';
    updates['lastRoundResult'] = {
        p1Points: p1Points,
        p2Points: p2Points
    };

    gameRef.update(updates);

    // ุงูุงูุชูุงู ููุฌููุฉ ุงูุชุงููุฉ ุจุนุฏ 5 ุซูุงูู
    setTimeout(() => {
        nextRound();
    }, 5000);
}

function nextRound() {
    if (gameData.round >= MAX_ROUNDS) {
        gameRef.update({ status: 'finished' });
    } else {
        gameRef.update({
            round: gameData.round + 1,
            roundStatus: 'playing',
            challenge: generateChallenge(),
            answers: null,
            lastRoundResult: null
        });
    }
}

// =========================================
// ๐ ุนุฑุถ ุงููุชุงุฆุฌ
// =========================================
function showRoundResults() {
    if (!gameData.answers || !gameData.answers[me.id] || !gameData.answers[opponentId]) return;

    let myAns = gameData.answers[me.id];
    let opAns = gameData.answers[opponentId];
    let letter = gameData.challenge.letter;

    let html = '<h3>ูุชุงุฆุฌ ุงูุฌููุฉ:</h3>';
    
    const categories = [
        { key: 'boyName', label: 'ุงุณู ููุฏ', type: 'boyNames' },
        { key: 'girlName', label: 'ุงุณู ุจูุช', type: 'girlNames' },
        { key: 'animal', label: 'ุญููุงู', type: 'animals' },
        { key: 'plant', label: 'ูุจุงุช', type: 'plants' },
        { key: 'object', label: 'ุฌูุงุฏ', type: 'objects' },
        { key: 'country', label: 'ุจูุงุฏ', type: 'countries' }
    ];

    categories.forEach(cat => {
        let mVal = myAns[cat.key];
        let oVal = opAns[cat.key];
        let mCheck = checkAnswer(letter, mVal, cat.type);
        let oCheck = checkAnswer(letter, oVal, cat.type);

        let mClass = mCheck ? 'correct' : 'wrong';
        let oClass = oCheck ? 'correct' : 'wrong';

        html += `
            <div class="result-item" style="background: #f8f9fa; border: 1px solid #ddd;">
                <div style="flex:1"><strong>${cat.label}</strong></div>
                <div class="${mClass}" style="flex:1; padding:5px; margin:0 5px; border-radius:4px;">ุฃูุช: ${mVal}</div>
                <div class="${oClass}" style="flex:1; padding:5px; margin:0 5px; border-radius:4px;">ุงูุฎุตู: ${oVal}</div>
            </div>
        `;
    });

    $("#resultBox").html(html).show();
    
    // ุนุฑุถ ุงููุงุฆุฒ ุจุงูุฌููุฉ
    if (gameData.lastRoundResult) {
        $("#winnerBox").html("ุงูุชูุช ุงูุฌููุฉ! ุฌุงุฑู ุงูุงูุชูุงู...").show();
    }
}

// =========================================
// ๐ ููุงูุฉ ุงููุนุจุฉ
// =========================================
function showGameOver() {
    $("#gameArea").hide();
    $("#gameOverBox").show();
    $("#endGameBtn").hide();

    let myScore = gameData.players[me.id].score;
    let opScore = gameData.players[opponentId].score;

    $("#myFinalScore").text(myScore);
    $("#opFinalScore").text(opScore);

    let resultText = "";
    let resultClass = "";

    if (myScore > opScore) {
        resultText = "๐ ูุจุฑูู! ุฃูุช ุงููุงุฆุฒ!";
        resultClass = "win";
    } else if (opScore > myScore) {
        resultText = "โ ุญุธ ุฃููุฑ! ุงูุฎุตู ูุงุฒ.";
        resultClass = "lose";
    } else {
        resultText = "๐ค ุชุนุงุฏู!";
        resultClass = "draw";
    }

    $("#finalResult").text(resultText).removeClass().addClass("final-result " + resultClass);
}

function endGame() {
    if (confirm("ูู ุชุฑูุฏ ุงูุงูุณุญุงุจุ")) {
        gameRef.update({ status: 'finished' });
    }
}

// =========================================
// ๐๏ธ ุฏูุงู ูุณุงุนุฏุฉ
// =========================================
function generateChallenge() {
    let letter = ARABIC_LETTERS[Math.floor(Math.random() * ARABIC_LETTERS.length)];
    return {
        letter: letter,
        category: `ุงูุชุจ ูููุงุช ุชุจุฏุฃ ุจุญุฑู: ${letter}`
    };
}

function checkAnswer(letter, answer, type) {
    if (!answer || answer.trim() === '') return false;
    answer = answer.trim();
    if (!answer.startsWith(letter)) return false;
    if (VALID_ANSWERS[letter] && VALID_ANSWERS[letter][type]) {
        return VALID_ANSWERS[letter][type].includes(answer);
    }
    return false;
}

// ุจุฏุก ุงููุนุจุฉ
initGame();


</script>

</body>
</html>