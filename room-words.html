<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¯ ØºØ±ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-auth.js"></script>
<script src="firebase-data.js"></script>
<style>
body{background:linear-gradient(135deg,#f093fb,#f5576c);min-height:100vh;padding:20px;font-family:'Segoe UI',sans-serif}
.game-box{max-width:900px;margin:0 auto;background:#fff;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
h2{text-align:center;color:#f5576c;font-size:28px;margin-bottom:10px}
.room-info{text-align:center;margin-bottom:20px;padding:15px;background:#f8f9fa;border-radius:8px}
.round-indicator{background:#6c757d;color:#fff;padding:8px 15px;border-radius:20px;font-size:14px;font-weight:600;display:inline-block;margin:10px 0}
.leaderboard{margin:20px 0}
.leaderboard-title{font-size:20px;font-weight:700;margin-bottom:15px;text-align:center}
.player-row{display:flex;align-items:center;padding:12px;margin-bottom:10px;background:#f8f9fa;border-radius:10px;transition:all .3s}
.player-row:hover{transform:translateX(-5px)}
.player-row.me{background:linear-gradient(135deg,#f093fb15,#f5576c15);border:2px solid #f5576c}
.player-rank{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;margin-left:15px}
.player-rank.gold{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#8b6914}
.player-rank.silver{background:linear-gradient(135deg,#c0c0c0,#e8e8e8);color:#4a4a4a}
.player-rank.bronze{background:linear-gradient(135deg,#cd7f32,#e3a857);color:#5c3d1f}
.player-rank.normal{background:#dee2e6;color:#333}
.player-name{flex:1;font-weight:600;font-size:16px}
.player-score{font-size:24px;font-weight:700;color:#f5576c}
.player-status{font-size:12px;padding:4px 10px;border-radius:12px;margin-right:10px}
.player-status.waiting{background:#fff3cd;color:#856404}
.player-status.answered{background:#d4edda;color:#155724}
.challenge-box{background:linear-gradient(135deg,#667eea,#764ba2);padding:30px;border-radius:15px;margin:20px 0;color:#fff;text-align:center}
.letter{font-size:80px;font-weight:700;margin:10px 0}
.category{font-size:20px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:20px 0}
.input-group label{display:block;margin-bottom:5px;font-weight:600}
input[type=text]{width:100%;padding:12px;font-size:16px;border:2px solid #ddd;border-radius:8px}
input:focus{border-color:#f5576c;outline:0}
input:disabled{background:#f0f0f0}
button{width:100%;padding:15px;background:#f5576c;color:#fff;border:0;border-radius:8px;font-size:18px;font-weight:600;cursor:pointer;margin-top:15px}
button:hover:not(:disabled){background:#e04658}
button:disabled{background:#ccc;cursor:not-allowed}
button.secondary{background:#6c757d}
button.start{background:#28a745;max-width:300px;margin:20px auto;display:block}
.waiting-message{text-align:center;padding:40px;background:#fff3cd;border-radius:10px;margin:20px 0}
@media(max-width:600px){.form-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="game-box">
<h2>ğŸ¯ ØºØ±ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</h2>
<div class="room-info">
<h3 id="roomName">ØºØ±ÙØ© Ø§Ù„Ù„Ø¹Ø¨</h3>
<div class="round-indicator" id="roundIndicator">Ø§Ù„Ø¬ÙˆÙ„Ø© 0 / 5</div>
</div>
<div class="leaderboard">
<div class="leaderboard-title">ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
<div id="leaderboardList"></div>
</div>
<div id="gameArea" style="display:none">
<div class="challenge-box">
<div class="letter" id="letterBox">ØŸ</div>
<div class="category" id="categoryBox">Ø§Ù†ØªØ¸Ø±...</div>
</div>
<div class="form-grid">
<div class="input-group"><label>ğŸ‘¦ Ø§Ø³Ù… ÙˆÙ„Ø¯</label><input type="text" id="boyName" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯"></div>
<div class="input-group"><label>ğŸ‘§ Ø§Ø³Ù… Ø¨Ù†Øª</label><input type="text" id="girlName" placeholder="Ù…Ø«Ø§Ù„: Ø¢ÙŠØ©"></div>
<div class="input-group"><label>ğŸ¦ Ø­ÙŠÙˆØ§Ù†</label><input type="text" id="animal" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø³Ø¯"></div>
<div class="input-group"><label>ğŸŒ³ Ù†Ø¨Ø§Øª</label><input type="text" id="plant" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø±Ø²"></div>
<div class="input-group"><label>ğŸº Ø¬Ù…Ø§Ø¯</label><input type="text" id="object" placeholder="Ù…Ø«Ø§Ù„: Ø¥Ø¨Ø±Ø©"></div>
<div class="input-group"><label>ğŸŒ Ø¨Ù„Ø§Ø¯</label><input type="text" id="country" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø£Ø±Ø¯Ù†"></div>
</div>
<button id="submitBtn" onclick="submitAnswers()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>
</div>
<div id="waitingArea" class="waiting-message">
<h3>â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ù†Ø´Ø¦ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©...</h3>
<button id="startBtn" class="start" onclick="startGame()" style="display:none">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>
<button class="secondary" onclick="location.href='rooms.html'">Ø±Ø¬ÙˆØ¹ Ù„Ù„ØºØ±Ù</button>
</div>
<script>
// Firebase is used instead of MockAPI
const LETTERS=['Ø§','Ø¨','Øª','Ø«','Ø¬','Ø­','Ø®','Ø¯','Ø°','Ø±','Ø²','Ø³','Ø´','Øµ','Ø¶','Ø·','Ø¸','Ø¹','Øº','Ù','Ù‚','Ùƒ','Ù„','Ù…','Ù†','Ù‡','Ùˆ','ÙŠ'];

// Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© - Ø´Ø§Ù…Ù„Ø©
const VALID = {
    'Ø§': {
        boyNames: ['Ø£Ø­Ù…Ø¯', 'Ø£Ù…ÙŠØ±', 'Ø£ÙŠÙ…Ù†', 'Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…', 'Ø¥Ø³Ù„Ø§Ù…', 'Ø£Ø³Ø§Ù…Ø©', 'Ø£Ù†Ø³', 'Ø¥ÙŠØ§Ø¯', 'Ø£Ø¯Ù‡Ù…', 'Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„', 'Ø£Ø¯ÙŠØ¨', 'Ø£Ø±ÙƒØ§Ù†', 'Ø¥Ù„ÙŠØ§Ø³', 'Ø£Ù…Ø¬Ø¯'],
        girlNames: ['Ø¢ÙŠØ©', 'Ø£Ù…Ù„', 'Ø¥ÙŠÙ…Ø§Ù†', 'Ø£Ø³Ù…Ø§Ø¡', 'Ø¢Ù„Ø§Ø¡', 'Ø£Ù…ÙŠØ±Ø©', 'Ø¥Ø³Ø±Ø§Ø¡', 'Ø£Ø±ÙŠØ¬', 'Ø¥ÙŠÙ†Ø§Ø³', 'Ø£Ù„ÙŠÙ†', 'Ø¢Ù…Ù†Ø©', 'Ø£Ù…ÙŠÙ†Ø©', 'Ø¥Ù„Ù‡Ø§Ù…', 'Ø£Ù†ÙØ§Ù„'],
        animals: ['Ø£Ø³Ø¯', 'Ø£Ø±Ù†Ø¨', 'Ø¥ÙˆØ²Ø©', 'Ø£ÙØ¹Ù‰', 'Ø£Ø®Ø·Ø¨ÙˆØ·'],
        plants: ['Ø£Ø±Ø²', 'Ø£Ù†Ø§Ù†Ø§Ø³', 'Ø¥Ø¬Ø§Øµ'],
        objects: ['Ø¥Ø¨Ø±Ø©', 'Ø£Ø±ÙŠÙƒØ©', 'Ø£ØµÙŠØµ', 'Ø¥Ù†Ø§Ø¡', 'Ø¥Ø·Ø§Ø±'],
        countries: ['Ø§Ù„Ø£Ø±Ø¯Ù†', 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª', 'Ø£Ù…Ø±ÙŠÙƒØ§', 'Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§', 'Ø¥ÙŠØ·Ø§Ù„ÙŠØ§', 'Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§', 'Ø£Ù„Ù…Ø§Ù†ÙŠØ§', 'Ø£ÙØºØ§Ù†Ø³ØªØ§Ù†', 'Ø¥ÙŠØ±Ø§Ù†', 'Ø£ÙˆÙƒØ±Ø§Ù†ÙŠØ§', 'Ø£ÙˆØºÙ†Ø¯Ø§', 'Ø¥Ø«ÙŠÙˆØ¨ÙŠØ§']
    },
    'Ø¨': {
        boyNames: ['Ø¨Ù„Ø§Ù„', 'Ø¨Ø§Ø³Ù„', 'Ø¨Ø´Ø§Ø±', 'Ø¨Ø¯Ø±', 'Ø¨Ø§Ø³Ù…', 'Ø¨ÙƒØ±', 'Ø¨Ø±Ø§Ø¡', 'Ø¨Ù‡Ø§Ø¡'],
        girlNames: ['Ø¨ØªÙˆÙ„', 'Ø¨Ø³Ù…Ø©', 'Ø¨Ø´Ø±Ù‰', 'Ø¨ÙŠØ§Ù†', 'Ø¨Ù„Ù‚ÙŠØ³', 'Ø¨Ø¯ÙˆØ±', 'Ø¨Ø³Ù†Øª', 'Ø¨ÙŠØ³Ø§Ù†'],
        animals: ['Ø¨Ù‚Ø±Ø©', 'Ø¨Ø·Ø©', 'Ø¨Ø¨ØºØ§Ø¡', 'Ø¨Ø¹ÙˆØ¶Ø©', 'Ø¨Ø¬Ø¹Ø©', 'Ø¨ÙˆÙ…Ø©', 'Ø¨ØºÙ„'],
        plants: ['Ø¨Ø·Ø§Ø·Ø³', 'Ø¨ØµÙ„', 'Ø¨Ù‚Ø¯ÙˆÙ†Ø³', 'Ø¨Ø±ØªÙ‚Ø§Ù„', 'Ø¨Ø·ÙŠØ®', 'Ø¨Ø±Ù‚ÙˆÙ‚', 'Ø¨Ø§Ù…ÙŠØ©', 'Ø¨Ø±ÙˆÙƒÙ„ÙŠ', 'Ø¨Ù†Ø¯ÙˆØ±Ø©'],
        objects: ['Ø¨Ø§Ø¨', 'Ø¨Ø·Ø§Ù†ÙŠØ©', 'Ø¨Ø±Ù…ÙŠÙ„', 'Ø¨Ù†Ø¯Ù‚ÙŠØ©', 'Ø¨ÙˆØµÙ„Ø©', 'Ø¨Ø§Ù„ÙˆÙ†', 'Ø¨Ø±Ø§Ø¯', 'Ø¨Ø·Ø§Ù‚Ø©'],
        countries: ['Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠØ§', 'Ø¨Ù„Ø¬ÙŠÙƒØ§', 'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†', 'Ø¨Ù†ØºÙ„Ø§Ø¯ÙŠØ´', 'Ø¨ÙˆÙ„Ù†Ø¯Ø§', 'Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„', 'Ø¨Ù„ØºØ§Ø±ÙŠØ§', 'Ø¨ÙˆÙ„ÙŠÙÙŠØ§']
    },
    'Øª': {
        boyNames: ['ØªØ§Ù…Ø±', 'ØªÙŠÙ…', 'ØªÙˆÙÙŠÙ‚', 'ØªÙ…ÙŠÙ…', 'ØªØ±ÙƒÙŠ'],
        girlNames: ['ØªØ§Ù„Ø§', 'ØªÙ…Ø§Ø±Ø§', 'ØªØ³Ù†ÙŠÙ…', 'ØªÙ‚Ù‰', 'ØªØ§Ù„Ø©', 'ØªØºØ±ÙŠØ¯', 'ØªÙŠÙ…Ø§Ø¡'],
        animals: ['ØªÙ…Ø³Ø§Ø­', 'ØªÙŠØ³', 'ØªØ±Ø³Ø©'],
        plants: ['ØªÙØ§Ø­', 'ØªÙˆØª', 'ØªÙŠÙ†', 'ØªÙ…Ø±'],
        objects: ['ØªÙ„ÙØ§Ø²', 'ØªÙ„ÙÙˆÙ†', 'ØªØ§Ø¬', 'ØªÙ†ÙˆØ±Ø©', 'ØªØ±Ù…Ø³', 'ØªØ§Ø¨ÙˆØª'],
        countries: ['ØªÙˆÙ†Ø³', 'ØªØ±ÙƒÙŠØ§', 'ØªØ§ÙŠÙ„Ø§Ù†Ø¯', 'ØªÙ†Ø²Ø§Ù†ÙŠØ§', 'ØªØ´ÙŠÙ„ÙŠ']
    },
    'Ø«': {
        boyNames: ['Ø«Ø§Ø¦Ø±', 'Ø«Ø§Ø¨Øª', 'Ø«Ø§Ù…Ø±'],
        girlNames: ['Ø«Ø±ÙŠØ§', 'Ø«Ù†Ø§Ø¡', 'Ø«Ø±Ø§Ø¡'],
        animals: ['Ø«Ø¹Ø¨Ø§Ù†', 'Ø«Ø¹Ù„Ø¨', 'Ø«ÙˆØ±'],
        plants: ['Ø«ÙˆÙ…', 'Ø«Ù…Ø§Ù…'],
        objects: ['Ø«Ù„Ø§Ø¬Ø©', 'Ø«ÙˆØ¨', 'Ø«Ø±ÙŠØ§'],
        countries: []
    },
    'Ø¬': {
        boyNames: ['Ø¬Ù…Ø§Ù„', 'Ø¬Ù„Ø§Ù„', 'Ø¬Ø§Ø¨Ø±', 'Ø¬Ø§Ø³Ù…', 'Ø¬Ù…ÙŠÙ„', 'Ø¬ÙˆØ§Ø¯', 'Ø¬Ø¹ÙØ±', 'Ø¬Ø§Ø¯'],
        girlNames: ['Ø¬Ù†Ù‰', 'Ø¬ÙˆØ¯', 'Ø¬ÙˆØ±ÙŠ', 'Ø¬Ù…ÙŠÙ„Ø©', 'Ø¬Ù†Ø§Ù†', 'Ø¬ÙˆÙ„ÙŠ', 'Ø¬ÙŠÙ‡Ø§Ù†', 'Ø¬Ù…Ø§Ù†Ø©'],
        animals: ['Ø¬Ù…Ù„', 'Ø¬Ø§Ù…ÙˆØ³', 'Ø¬Ø±Ø§Ø¯', 'Ø¬Ø±Ø°'],
        plants: ['Ø¬Ø²Ø±', 'Ø¬Ø±Ø¬ÙŠØ±', 'Ø¬ÙˆØ§ÙØ©', 'Ø¬ÙˆØ² Ù‡Ù†Ø¯'],
        objects: ['Ø¬ÙˆØ§Ù„', 'Ø¬Ø±Ø³', 'Ø¬Ø¯Ø§Ø±', 'Ø¬Ù‡Ø§Ø²', 'Ø¬Ø²Ù…Ø©', 'Ø¬ÙˆØ§Ø±Ø¨'],
        countries: ['Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', 'Ø¬ÙŠØ¨ÙˆØªÙŠ', 'Ø¬ÙˆØ±Ø¬ÙŠØ§', 'Ø¬Ø§Ù…Ø§ÙŠÙƒØ§']
    },
    'Ø­': {
        boyNames: ['Ø­Ø³Ù†', 'Ø­Ø³ÙŠÙ†', 'Ø­Ù…Ø²Ø©', 'Ø­Ø³Ø§Ù…', 'Ø­Ø§ØªÙ…', 'Ø­Ø°ÙŠÙØ©', 'Ø­Ø§Ø±Ø«', 'Ø­Ù„ÙŠÙ…'],
        girlNames: ['Ø­Ù†Ø§Ù†', 'Ø­Ù„Ø§', 'Ø­Ù†ÙŠÙ†', 'Ø­ÙˆØ±ÙŠØ©', 'Ø­Ø³Ù†Ø§Ø¡', 'Ø­ÙŠØ§Ø©', 'Ø­Ø¨ÙŠØ¨Ø©', 'Ø­Ù…ÙŠØ¯Ø©'],
        animals: ['Ø­ØµØ§Ù†', 'Ø­Ù…Ø§Ø±', 'Ø­Ù…Ø§Ù…Ø©', 'Ø­ÙˆØª', 'Ø­Ù„Ø²ÙˆÙ†', 'Ø­Ø±Ø¨Ø§Ø¡', 'Ø­Ø´Ø±Ø©'],
        plants: ['Ø­Ù…Øµ', 'Ø­Ù†Ø·Ø©'],
        objects: ['Ø­Ø°Ø§Ø¡', 'Ø­Ù‚ÙŠØ¨Ø©', 'Ø­Ø¨Ù„', 'Ø­Ø²Ø§Ù…', 'Ø­Ø¬Ø±', 'Ø­Ù„Ù‚'],
        countries: []
    },
    'Ø®': {
        boyNames: ['Ø®Ø§Ù„Ø¯', 'Ø®Ù„ÙŠÙ„', 'Ø®Ø¶Ø±', 'Ø®Ù„ÙŠÙØ©', 'Ø®Ø·Ø§Ø¨'],
        girlNames: ['Ø®Ø¯ÙŠØ¬Ø©', 'Ø®ÙˆÙ„Ø©', 'Ø®Ù„ÙˆØ¯', 'Ø®ÙŠØ±ÙŠØ©'],
        animals: ['Ø®Ø±ÙˆÙ', 'Ø®Ù†Ø²ÙŠØ±', 'Ø®ÙØ§Ø´', 'Ø®ÙŠÙ„'],
        plants: ['Ø®Ø³', 'Ø®ÙŠØ§Ø±', 'Ø®ÙˆØ®', 'Ø®Ø¨ÙŠØ²Ø©'],
        objects: ['Ø®Ø§ØªÙ…', 'Ø®ÙŠØ·', 'Ø®Ø±ÙŠØ·Ø©', 'Ø®Ø²Ø§Ù†Ø©', 'Ø®ÙŠÙ…Ø©'],
        countries: []
    },
    'Ø¯': {
        boyNames: ['Ø¯Ø§ÙˆØ¯', 'Ø¯Ø§Ù†ÙŠØ§Ù„', 'Ø¯ÙŠØ¨', 'Ø¯Ø±ÙˆÙŠØ´'],
        girlNames: ['Ø¯Ø§Ù†Ø©', 'Ø¯ÙŠÙ†Ø§', 'Ø¯ÙŠÙ…Ø§', 'Ø¯Ø¹Ø§Ø¡', 'Ø¯ÙŠØ§Ù„Ø§', 'Ø¯Ù„Ø§Ù„', 'Ø¯Ø§Ø±ÙŠÙ†'],
        animals: ['Ø¯Ø¬Ø§Ø¬Ø©', 'Ø¯ÙŠÙƒ', 'Ø¯Ø¨', 'Ø¯ÙˆÙ„ÙÙŠÙ†', 'Ø¯ÙˆØ¯Ø©'],
        plants: ['Ø¯Ø±Ø§Ù‚', 'Ø¯ÙˆÙ…', 'Ø¯ÙˆØ§Ø± Ø§Ù„Ø´Ù…Ø³'],
        objects: ['Ø¯ÙØªØ±', 'Ø¯Ø±Ø¬', 'Ø¯ÙˆÙ„Ø§Ø¨', 'Ø¯Ø¨ÙˆØ³', 'Ø¯Ø±Ø§Ø¬Ø©'],
        countries: ['Ø¯Ø¨ÙŠ', 'Ø§Ù„Ø¯Ù†Ù…Ø§Ø±Ùƒ']
    },
    'Ø°': {
        boyNames: ['Ø°ÙŠØ§Ø¨', 'Ø°ÙƒÙŠ'],
        girlNames: ['Ø°ÙƒØ±Ù‰'],
        animals: ['Ø°Ø¦Ø¨', 'Ø°Ø¨Ø§Ø¨Ø©'],
        plants: ['Ø°Ø±Ø©'],
        objects: ['Ø°Ù‡Ø¨'],
        countries: []
    },
    'Ø±': {
        boyNames: ['Ø±Ø§Ù…ÙŠ', 'Ø±Ø§Ø´Ø¯', 'Ø±Ø¶Ø§', 'Ø±ÙŠØ§Ø¶', 'Ø±Ø§Ø¦Ø¯', 'Ø±Ø´ÙŠØ¯', 'Ø±Ø§ÙØª', 'Ø±Ø¨ÙŠØ¹'],
        girlNames: ['Ø±Ù†Ø§', 'Ø±ÙŠÙ…', 'Ø±Ù‡Ù', 'Ø±ÙˆØ§Ù†', 'Ø±ØºØ¯', 'Ø±Ù†ÙŠÙ…', 'Ø±Ø¨Ø§Ø¨', 'Ø±Ø´Ø§', 'Ø±ÙˆØ²', 'Ø±Ø§Ù†ÙŠØ§'],
        animals: ['Ø±Ø®Ù…', 'Ø±ÙŠÙ…'],
        plants: ['Ø±Ù…Ø§Ù†', 'Ø±ÙˆØ²Ù…Ø§Ø±ÙŠ', 'Ø±ÙŠØ­Ø§Ù†'],
        objects: ['Ø±Ø§Ø¯ÙŠÙˆ', 'Ø±Ù', 'Ø±Ù…Ø­', 'Ø±ÙŠÙ…ÙˆØª'],
        countries: ['Ø±ÙˆØ³ÙŠØ§', 'Ø±ÙˆÙ…Ø§Ù†ÙŠØ§', 'Ø±ÙˆØ§Ù†Ø¯Ø§']
    },
    'Ø²': {
        boyNames: ['Ø²ÙŠØ¯', 'Ø²ÙŠØ§Ø¯', 'Ø²Ø§Ù‡Ø±', 'Ø²ÙƒØ±ÙŠØ§', 'Ø²ÙŠÙ†', 'Ø²Ø§Ù‡ÙŠ'],
        girlNames: ['Ø²ÙŠÙ†Ø¨', 'Ø²Ù‡Ø±Ø§Ø¡', 'Ø²ÙŠÙ†Ø©', 'Ø²Ù‡Ø±Ø©', 'Ø²ÙŠÙ†', 'Ø²Ù…Ø²Ù…'],
        animals: ['Ø²Ø±Ø§ÙØ©', 'Ø²ÙˆØ§Ø­Ù', 'Ø²ÙŠØ¨Ø±Ø§'],
        plants: ['Ø²ÙŠØªÙˆÙ†', 'Ø²Ù†Ø¬Ø¨ÙŠÙ„', 'Ø²Ø¹ØªØ±', 'Ø²Ù‡Ø±Ø©'],
        objects: ['Ø²Ø¬Ø§Ø¬', 'Ø²Ø±', 'Ø²Ø¬Ø§Ø¬Ø©', 'Ø²ÙˆØ±Ù‚'],
        countries: ['Ø²ÙŠÙ…Ø¨Ø§Ø¨ÙˆÙŠ', 'Ø²Ø§Ù…Ø¨ÙŠØ§']
    },
    'Ø³': {
        boyNames: ['Ø³Ø§Ù…ÙŠ', 'Ø³Ø¹ÙŠØ¯', 'Ø³Ø§Ù„Ù…', 'Ø³Ù„ÙŠÙ…', 'Ø³Ù„Ø·Ø§Ù†', 'Ø³Ø¹Ø¯', 'Ø³Ù„ÙŠÙ…Ø§Ù†', 'Ø³Ø§Ù…Ø±', 'Ø³ÙÙŠØ§Ù†'],
        girlNames: ['Ø³Ø§Ø±Ø©', 'Ø³Ù„Ù…Ù‰', 'Ø³Ù†Ø§Ø¡', 'Ø³Ù…ÙŠØ©', 'Ø³Ù„Ø³Ø¨ÙŠÙ„', 'Ø³Ù…Ø§', 'Ø³Ù…Ø±', 'Ø³Ù‡ÙŠØ±', 'Ø³Ù‡Ù‰'],
        animals: ['Ø³Ù…ÙƒØ©', 'Ø³Ù„Ø­ÙØ§Ø©', 'Ø³Ù†Ø¬Ø§Ø¨', 'Ø³Ù…Ø§Ù†', 'Ø³Ø­Ù„ÙŠØ©', 'Ø³Ø±Ø·Ø§Ù†'],
        plants: ['Ø³Ø¨Ø§Ù†Ø®', 'Ø³ÙØ±Ø¬Ù„', 'Ø³Ù…Ø§Ù‚'],
        objects: ['Ø³Ø±ÙŠØ±', 'Ø³ÙŠØ§Ø±Ø©', 'Ø³Ø§Ø¹Ø©', 'Ø³Ø¬Ø§Ø¯Ø©', 'Ø³Ù„Ù…', 'Ø³ÙƒÙŠÙ†', 'Ø³ÙÙŠÙ†Ø©', 'Ø³Ù„Ø©'],
        countries: ['Ø³ÙˆØ±ÙŠØ§', 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', 'Ø§Ù„Ø³ÙˆØ¯Ø§Ù†', 'Ø³Ù†ØºØ§ÙÙˆØ±Ø©', 'Ø³ÙˆÙŠØ³Ø±Ø§', 'Ø§Ù„Ø³ÙˆÙŠØ¯', 'Ø³Ø±ÙŠÙ„Ø§Ù†ÙƒØ§']
    },
    'Ø´': {
        boyNames: ['Ø´Ø§Ø¯ÙŠ', 'Ø´Ø§Ù‡Ø±', 'Ø´Ø±ÙŠÙ', 'Ø´ÙƒØ±ÙŠ', 'Ø´Ù‡Ø§Ø¨'],
        girlNames: ['Ø´ÙŠÙ…Ø§Ø¡', 'Ø´Ø°Ù‰', 'Ø´Ù‡Ø¯', 'Ø´ÙŠØ±ÙŠÙ†', 'Ø´Ø±ÙˆÙ‚', 'Ø´Ø§Ø¯ÙŠØ©'],
        animals: ['Ø´Ù…Ø¨Ø§Ù†Ø²ÙŠ', 'Ø´Ø§Ù‡ÙŠÙ†'],
        plants: ['Ø´Ù…Ø§Ù…', 'Ø´Ø¹ÙŠØ±', 'Ø´Ø§ÙŠ'],
        objects: ['Ø´Ø¨Ø§Ùƒ', 'Ø´Ù†Ø·Ø©', 'Ø´Ù…Ø¹', 'Ø´Ù…Ø§Ø¹Ø©', 'Ø´Ø±Ø§Ø¨'],
        countries: []
    },
    'Øµ': {
        boyNames: ['ØµØ§Ù„Ø­', 'ØµÙ„Ø§Ø­', 'ØµÙ‡ÙŠØ¨', 'ØµØ§Ø¯Ù‚', 'ØµØ¨Ø­ÙŠ', 'ØµÙÙˆØ§Ù†'],
        girlNames: ['ØµÙØ§Ø¡', 'ØµØ§Ø¨Ø±ÙŠÙ†', 'ØµÙÙŠØ©', 'ØµØ¨Ø§'],
        animals: ['ØµÙ‚Ø±', 'ØµØ±ØµÙˆØ±'],
        plants: ['ØµØ¨Ø§Ø±', 'ØµÙ†ÙˆØ¨Ø±'],
        objects: ['ØµÙ†Ø¯ÙˆÙ‚', 'ØµØ­Ù†', 'ØµØ§Ø¨ÙˆÙ†', 'ØµÙˆØ±Ø©'],
        countries: ['Ø§Ù„ØµÙŠÙ†', 'Ø§Ù„ØµÙˆÙ…Ø§Ù„']
    },
    'Ø¶': {
        boyNames: ['Ø¶ÙŠØ§Ø¡', 'Ø¶Ø§Ø±ÙŠ', 'Ø¶Ø±ØºØ§Ù…'],
        girlNames: ['Ø¶Ø­Ù‰', 'Ø¶ÙŠ'],
        animals: ['Ø¶Ø¨Ø¹', 'Ø¶ÙØ¯Ø¹'],
        plants: [],
        objects: ['Ø¶ÙˆØ¡'],
        countries: []
    },
    'Ø·': {
        boyNames: ['Ø·Ø§Ø±Ù‚', 'Ø·Ù„Ø§Ù„', 'Ø·Ø§Ù‡Ø±', 'Ø·Ù‡'],
        girlNames: ['Ø·ÙŠÙ', 'Ø·ÙŠØ¨Ø©'],
        animals: ['Ø·Ø§ÙˆÙˆØ³'],
        plants: ['Ø·Ù…Ø§Ø·Ù…', 'Ø·Ø­Ø§Ù„Ø¨'],
        objects: ['Ø·Ø§ÙˆÙ„Ø©', 'Ø·Ø§Ø¦Ø±Ø©', 'Ø·Ø¨Ù„', 'Ø·ÙˆØ¨'],
        countries: []
    },
    'Ø¸': {
        boyNames: ['Ø¸Ø§ÙØ±'],
        girlNames: [],
        animals: ['Ø¸Ø¨ÙŠ'],
        plants: [],
        objects: ['Ø¸Ø±Ù'],
        countries: []
    },
    'Ø¹': {
        boyNames: ['Ø¹Ù…Ø±', 'Ø¹Ù„ÙŠ', 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡', 'Ø¹Ø«Ù…Ø§Ù†', 'Ø¹Ø§Ù…Ø±', 'Ø¹Ø¯Ù†Ø§Ù†', 'Ø¹Ù…Ø§Ø¯', 'Ø¹ØµØ§Ù…', 'Ø¹Ø²ÙŠØ²'],
        girlNames: ['Ø¹Ø§Ø¦Ø´Ø©', 'Ø¹Ù„Ø§', 'Ø¹Ø¨ÙŠØ±', 'Ø¹Ù‡Ø¯', 'Ø¹ÙØ§Ù', 'Ø¹Ø²Ø©', 'Ø¹Ù†ÙˆØ¯', 'Ø¹Ø§Ù„ÙŠØ©'],
        animals: ['Ø¹ØµÙÙˆØ±', 'Ø¹Ù‚Ø±Ø¨', 'Ø¹Ù†ÙƒØ¨ÙˆØª', 'Ø¹Ø¬Ù„'],
        plants: ['Ø¹Ù†Ø¨', 'Ø¹Ø¯Ø³', 'Ø¹Ø±Ø¹Ø±'],
        objects: ['Ø¹ØµØ§', 'Ø¹Ù‚Ø¯', 'Ø¹ÙŠÙ†', 'Ø¹Ø¬Ù„Ø©'],
        countries: ['Ø¹Ù…Ø§Ù†', 'Ø§Ù„Ø¹Ø±Ø§Ù‚']
    },
    'Øº': {
        boyNames: ['ØºØ³Ø§Ù†', 'ØºØ§Ø²ÙŠ', 'ØºØ§Ù„Ø¨', 'ØºÙŠØ«'],
        girlNames: ['ØºØ§Ø¯Ø©', 'ØºØ§Ù„ÙŠØ©', 'ØºÙŠØ¯Ø§Ø¡', 'ØºØ²Ù„'],
        animals: ['ØºØ±Ø§Ø¨', 'ØºØ²Ø§Ù„', 'ØºÙˆØ±ÙŠÙ„Ø§'],
        plants: ['ØºØ§Ø±'],
        objects: ['ØºØ·Ø§Ø¡', 'ØºØ±ÙØ©'],
        countries: ['ØºØ§Ù†Ø§', 'ØºÙˆØ§ØªÙŠÙ…Ø§Ù„Ø§', 'ØºÙŠÙ†ÙŠØ§']
    },
    'Ù': {
        boyNames: ['ÙØ§Ø±Ø³', 'ÙÙ‡Ø¯', 'ÙÙŠØµÙ„', 'ÙØ±Ø§Ø³', 'ÙØ§Ø¯ÙŠ', 'ÙÙˆØ§Ø²', 'ÙØ¤Ø§Ø¯'],
        girlNames: ['ÙØ§Ø·Ù…Ø©', 'ÙØ±Ø­', 'ÙØ±ÙŠØ¯Ø©', 'ÙØ§ÙŠØ²Ø©', 'ÙØ¯ÙˆÙ‰', 'ÙØ¯Ø§Ø¡'],
        animals: ['ÙÙŠÙ„', 'ÙÙ‡Ø¯', 'ÙØ£Ø±', 'ÙØ±Ø§Ø´Ø©'],
        plants: ['ÙÙˆÙ„', 'ÙØ¬Ù„', 'ÙØ³ØªÙ‚', 'ÙØ±Ø§ÙˆÙ„Ø©'],
        objects: ['ÙØ±Ù†', 'ÙØ±Ø´Ø§Ø©', 'ÙØ§Ù†ÙˆØ³', 'ÙØ£Ø³'],
        countries: ['ÙÙ„Ø³Ø·ÙŠÙ†', 'ÙØ±Ù†Ø³Ø§', 'ÙÙ†Ù„Ù†Ø¯Ø§', 'Ø§Ù„ÙÙ„Ø¨ÙŠÙ†', 'ÙÙ†Ø²ÙˆÙŠÙ„Ø§']
    },
    'Ù‚': {
        boyNames: ['Ù‚Ø§Ø³Ù…', 'Ù‚ØµÙŠ', 'Ù‚ÙŠØ³', 'Ù‚ØªÙŠØ¨Ø©'],
        girlNames: ['Ù‚Ù…Ø±'],
        animals: ['Ù‚Ø±Ø¯', 'Ù‚Ø·', 'Ù‚Ù†ÙØ°', 'Ù‚Ù†Ø¯ÙŠÙ„'],
        plants: ['Ù‚Ù…Ø­', 'Ù‚Ø±Ù†Ø¨ÙŠØ·', 'Ù‚Ø±Ø¹'],
        objects: ['Ù‚Ù„Ù…', 'Ù‚Ù…ÙŠØµ', 'Ù‚ÙÙ„', 'Ù‚Ø¨Ø¹Ø©', 'Ù‚Ø§Ø±Ø¨'],
        countries: ['Ù‚Ø·Ø±', 'Ù‚Ø¨Ø±Øµ']
    },
    'Ùƒ': {
        boyNames: ['ÙƒØ±ÙŠÙ…', 'ÙƒÙ…Ø§Ù„', 'ÙƒØ±Ù…', 'ÙƒØ§Ù…Ù„'],
        girlNames: ['ÙƒØ±ÙŠÙ…Ø©', 'ÙƒÙˆØ«Ø±', 'ÙƒØ§Ù…ÙŠÙ„ÙŠØ§'],
        animals: ['ÙƒÙ„Ø¨', 'ÙƒÙ†ØºØ±', 'ÙƒÙˆØ§Ù„Ø§'],
        plants: ['ÙƒØ±Ø²', 'ÙƒØ±Ø§Ø«', 'ÙƒÙ…Ø«Ø±Ù‰', 'ÙƒØ²Ø¨Ø±Ø©', 'ÙƒÙŠÙˆÙŠ'],
        objects: ['ÙƒØªØ§Ø¨', 'ÙƒØ±Ø³ÙŠ', 'ÙƒÙˆØ¨', 'ÙƒØ±Ø©'],
        countries: ['Ø§Ù„ÙƒÙˆÙŠØª', 'ÙƒÙ†Ø¯Ø§', 'ÙƒÙˆØ±ÙŠØ§', 'ÙƒÙˆÙ„ÙˆÙ…Ø¨ÙŠØ§', 'ÙƒÙŠÙ†ÙŠØ§']
    },
    'Ù„': {
        boyNames: ['Ù„ÙŠØ«', 'Ù„Ø¤ÙŠ', 'Ù„Ù‚Ù…Ø§Ù†'],
        girlNames: ['Ù„ÙŠÙ„Ù‰', 'Ù„ÙŠÙ†Ø§', 'Ù„Ù…Ù‰', 'Ù„Ø§Ø±Ø§', 'Ù„Ø¨Ù†Ù‰', 'Ù„Ø·ÙŠÙØ©', 'Ù„Ø¬ÙŠÙ†'],
        animals: ['Ù„ÙŠØ«', 'Ù„Ø§Ù…Ø§'],
        plants: ['Ù„ÙŠÙ…ÙˆÙ†', 'Ù„ÙˆØ²', 'Ù„ÙˆØ¨ÙŠØ§'],
        objects: ['Ù„Ù…Ø¨Ø©', 'Ù„ÙˆØ­Ø©'],
        countries: ['Ù„Ø¨Ù†Ø§Ù†', 'Ù„ÙŠØ¨ÙŠØ§', 'Ù„ÙˆÙƒØ³Ù…Ø¨ÙˆØ±Øº']
    },
    'Ù…': {
        boyNames: ['Ù…Ø­Ù…Ø¯', 'Ù…Ø­Ù…ÙˆØ¯', 'Ù…ØµØ·ÙÙ‰', 'Ù…Ø¹Ø§Ø°', 'Ù…Ø§Ù„Ùƒ', 'Ù…Ø±Ø§Ø¯', 'Ù…Ø±ÙˆØ§Ù†', 'Ù…Ù‡Ù†Ø¯', 'Ù…Ø§Ø¬Ø¯', 'Ù…Ù†ÙŠØ±'],
        girlNames: ['Ù…Ø±ÙŠÙ…', 'Ù…Ù„Ùƒ', 'Ù…Ù†Ù‰', 'Ù…ÙŠØ±Ø§', 'Ù…Ø§Ø±ÙŠØ§', 'Ù…Ù‡Ø§', 'Ù…ÙŠØ³', 'Ù…Ø±Ø§Ù…', 'Ù…ÙŠ', 'Ù…Ù†Ø§Ù„'],
        animals: ['Ù…Ø§Ø¹Ø²', 'Ù…Ù‡Ø§', 'Ù…Ø§Ù…ÙˆØ«'],
        plants: ['Ù…ÙˆØ²', 'Ù…Ø§Ù†Ø¬Ùˆ', 'Ù…Ù„ÙˆØ®ÙŠØ©', 'Ù…Ù„ÙÙˆÙ', 'Ù…Ø´Ù…Ø´'],
        objects: ['Ù…ÙØªØ§Ø­', 'Ù…ÙƒØªØ¨', 'Ù…Ø±ÙˆØ­Ø©', 'Ù…Ù„Ø¹Ù‚Ø©', 'Ù…Ù‚Øµ', 'Ù…ØµØ¨Ø§Ø­', 'Ù…Ø±Ø¢Ø©'],
        countries: ['Ù…ØµØ±', 'Ø§Ù„Ù…ØºØ±Ø¨', 'Ù…Ø§Ù„ÙŠØ²ÙŠØ§', 'Ø§Ù„Ù…ÙƒØ³ÙŠÙƒ', 'Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§']
    },
    'Ù†': {
        boyNames: ['Ù†Ø§Ø¯Ø±', 'Ù†Ø§ØµØ±', 'Ù†Ø¨ÙŠÙ„', 'Ù†ÙˆØ§Ù', 'Ù†Ø§ÙŠÙ', 'Ù†Ø²Ø§Ø±'],
        girlNames: ['Ù†ÙˆØ±', 'Ù†Ø§Ø¯ÙŠØ©', 'Ù†Ù‡Ù‰', 'Ù†Ø¬Ù„Ø§Ø¡', 'Ù†Ø¬ÙˆÙ‰', 'Ù†Ø³Ø±ÙŠÙ†', 'Ù†Ø±Ù…ÙŠÙ†', 'Ù†Ø§Ø¯ÙŠØ§'],
        animals: ['Ù†Ù…Ø±', 'Ù†Ø­Ù„Ø©', 'Ù†Ø¹Ø§Ù…Ø©', 'Ù†Ø³Ø±', 'Ù†Ù…Ù„'],
        plants: ['Ù†Ø¹Ù†Ø§Ø¹', 'Ù†Ø±Ø¬Ø³'],
        objects: ['Ù†Ø§ÙØ°Ø©', 'Ù†Ø¸Ø§Ø±Ø©', 'Ù†Ø¬ÙØ©'],
        countries: ['Ø§Ù„Ù†Ø±ÙˆÙŠØ¬', 'Ù†ÙŠØ¬ÙŠØ±ÙŠØ§', 'Ù†ÙŠÙˆØ²ÙŠÙ„Ù†Ø¯Ø§', 'Ø§Ù„Ù†Ù…Ø³Ø§', 'Ù†ÙŠØ¨Ø§Ù„']
    },
    'Ù‡': {
        boyNames: ['Ù‡Ø§Ù†ÙŠ', 'Ù‡Ø´Ø§Ù…', 'Ù‡ÙŠØ«Ù…', 'Ù‡Ø§Ø¯ÙŠ', 'Ù‡Ù…Ø§Ù…'],
        girlNames: ['Ù‡Ø§Ù„Ø©', 'Ù‡Ø¨Ø©', 'Ù‡Ø¯Ù‰', 'Ù‡Ù†Ø¯', 'Ù‡Ù†Ø§Ø¯ÙŠ', 'Ù‡ÙŠØ§', 'Ù‡ÙŠÙØ§Ø¡'],
        animals: ['Ù‡Ø±', 'Ù‡Ø¯Ù‡Ø¯'],
        plants: ['Ù‡ÙŠÙ„'],
        objects: ['Ù‡Ø§ØªÙ'],
        countries: ['Ù‡ÙˆÙ„Ù†Ø¯Ø§', 'Ø§Ù„Ù‡Ù†Ø¯', 'Ù‡ÙˆÙ†Øº ÙƒÙˆÙ†Øº']
    },
    'Ùˆ': {
        boyNames: ['ÙˆØ§Ø¦Ù„', 'ÙˆÙ„ÙŠØ¯', 'ÙˆØ³Ø§Ù…', 'ÙˆØ³ÙŠÙ…'],
        girlNames: ['ÙˆÙØ§Ø¡', 'ÙˆØ±Ø¯', 'ÙˆØ¹Ø¯', 'ÙˆØ³Ù†', 'ÙˆØ¯Ø§Ø¯'],
        animals: ['ÙˆØ¹Ù„', 'ÙˆØ²Ø©', 'ÙˆØ·ÙˆØ§Ø·'],
        plants: ['ÙˆØ±Ø¯'],
        objects: ['ÙˆØ³Ø§Ø¯Ø©'],
        countries: []
    },
    'ÙŠ': {
        boyNames: ['ÙŠØ§Ø³Ø±', 'ÙŠÙˆØ³Ù', 'ÙŠØ²Ù†', 'ÙŠØ§Ù…Ù†', 'ÙŠØ²ÙŠØ¯', 'ÙŠØ§Ø³ÙŠÙ†', 'ÙŠØ­ÙŠÙ‰'],
        girlNames: ['ÙŠØ§Ø³Ù…ÙŠÙ†', 'ÙŠØ§Ø±Ø§', 'ÙŠØ³Ø±Ù‰', 'ÙŠÙ…Ù†Ù‰', 'ÙŠØ³Ø±'],
        animals: ['ÙŠÙ…Ø§Ù…Ø©', 'ÙŠØ¹Ø³ÙˆØ¨'],
        plants: ['ÙŠÙˆØ³ÙÙŠ', 'ÙŠØ§Ø³Ù…ÙŠÙ†'],
        objects: ['ÙŠØ§Ù‚Ø©'],
        countries: ['Ø§Ù„ÙŠÙ…Ù†', 'Ø§Ù„ÙŠØ§Ø¨Ø§Ù†', 'ÙŠÙˆØºÙˆØ³Ù„Ø§ÙÙŠØ§']
    }
};

let me = JSON.parse(localStorage.getItem("user"));
if (!me) location.href = "login.html";

let roomId = new URLSearchParams(location.search).get("room");
let room = null;
let roomRef = firebase.database().ref('rooms/' + roomId);

function generateChallenge() {
    let l = LETTERS[Math.floor(Math.random() * LETTERS.length)];
    return {
        letter: l,
        category: `Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø§Øª ØªØ¨Ø¯Ø£ Ø¨Ø­Ø±Ù: ${l}`
    };
}

function checkAnswer(l, a, t) {
    if (!a || !a.trim()) return null;
    a = a.trim();
    if (!a.startsWith(l)) return false;
    if (VALID[l]) {
        let v = VALID[l][t] || [];
        return v.includes(a);
    }
    return false;
}

function loadRoom() {
    roomRef.on('value', snapshot => {
        room = snapshot.val();
        if (!room) {
            alert("Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!");
            location.href = "rooms.html";
            return;
        }

        $("#roomName").text(room.name);
        $("#roundIndicator").text(`Ø§Ù„Ø¬ÙˆÙ„Ø© ${room.currentRound || 0} / ${room.maxRounds}`);
        
        if(room.players) {
            room.players.sort((a, b) => (b.score || 0) - (a.score || 0));
        }
        displayLeaderboard();

        if (room.status === 'waiting' && room.creatorId === String(me.id)) $("#startBtn").show();

        if (room.status === 'waiting') {
            $("#waitingArea").show();
            $("#gameArea").hide();
        } else if (room.status === 'playing') {
            $("#waitingArea").hide();
            $("#gameArea").show();

            if (!room.currentQuestion) {
                if (room.creatorId === String(me.id)) {
                    let c = generateChallenge();
                    roomRef.update({
                        currentQuestion: c,
                        answers: {}
                    });
                }
            } else {
                displayChallenge();
            }

            if (room.creatorId === String(me.id) && room.answers) {
                let playersList = room.players || [];
                let allAnswered = playersList.every(p => room.answers[p.id]);
                if (allAnswered && playersList.length > 0) {
                    calculateScores();
                }
            }

        } else if (room.status === 'finished') {
            location.href = "room-results.html?room=" + roomId;
        }
    });
}

function displayLeaderboard() {
    let c = $("#leaderboardList").html("");
    if(!room.players) return;
    
    room.players.forEach((p, i) => {
        let r = i + 1,
            rc = 'normal',
            t = '';
        if (r === 1) {
            rc = 'gold';
            t = 'ğŸ‘‘';
        } else if (r === 2) {
            rc = 'silver';
            t = 'ğŸ¥ˆ';
        } else if (r === 3) {
            rc = 'bronze';
            t = 'ğŸ¥‰';
        }
        let isMe = p.id === String(me.id),
            row = isMe ? 'player-row me' : 'player-row',
            st = '';
        if (room.status === 'playing') {
            if (room.answers && room.answers[p.id]) st = '<span class="player-status answered">âœ… Ø£Ø¬Ø§Ø¨</span>';
            else st = '<span class="player-status waiting">â³ ÙŠÙ†ØªØ¸Ø±</span>';
        }
        c.append(`<div class="${row}"><div class="player-rank ${rc}">${t || r}</div><div class="player-name">${p.username}${isMe ? ' (Ø£Ù†Øª)' : ''}</div>${st}<div class="player-score">${p.score || 0}</div></div>`);
    });
}

function startGame() {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ")) return;
    let c = generateChallenge();
    roomRef.update({
        status: 'playing',
        currentRound: 1,
        currentQuestion: c,
        answers: {}
    });
}

function displayChallenge() {
    if (!room.currentQuestion) return;
    $("#letterBox").text(room.currentQuestion.letter);
    $("#categoryBox").text(room.currentQuestion.category);
    
    if (room.answers && room.answers[String(me.id)]) {
        $("input").prop("disabled", true);
        $("#submitBtn").prop("disabled", true);
        $("#submitBtn").text("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª");
    } else {
        $("input").prop("disabled", false);
        $("#submitBtn").prop("disabled", false);
        $("#submitBtn").text("Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª");
    }
}

function submitAnswers() {
    let a = {
        boyName: $("#boyName").val().trim(),
        girlName: $("#girlName").val().trim(),
        animal: $("#animal").val().trim(),
        plant: $("#plant").val().trim(),
        object: $("#object").val().trim(),
        country: $("#country").val().trim()
    };
    
    firebase.database().ref(`rooms/${roomId}/answers/${me.id}`).set({
        answers: a,
        time: Date.now()
    });
    
    $("input").prop("disabled", true);
    $("#submitBtn").prop("disabled", true);
}

function calculateScores() {
    if(window.calculating) return;
    window.calculating = true;

    let l = room.currentQuestion.letter,
        cats = [{
            key: 'boyName',
            type: 'boyNames'
        }, {
            key: 'girlName',
            type: 'girlNames'
        }, {
            key: 'animal',
            type: 'animals'
        }, {
            key: 'plant',
            type: 'plants'
        }, {
            key: 'object',
            type: 'objects'
        }, {
            key: 'country',
            type: 'countries'
        }],
        scores = {},
        fastest = {};
        
    room.players.forEach(p => {
        let pd = room.answers[p.id];
        if (!pd) return;
        let sc = 0;
        cats.forEach(c => {
            let ans = pd.answers[c.key],
                cor = checkAnswer(l, ans, c.type);
            if (cor === true) {
                sc++;
                if (!fastest[c.key] || pd.time < fastest[c.key].time) fastest[c.key] = {
                    playerId: p.id,
                    time: pd.time
                };
            }
        });
        scores[p.id] = sc;
    });
    
    Object.values(fastest).forEach(f => {
        if (f && scores[f.playerId] > 0) scores[f.playerId] += 1;
    });
    
    let updatedPlayers = room.players.map(p => {
        p.score = (p.score || 0) + (scores[p.id] || 0);
        return p;
    });

    let updates = {
        players: updatedPlayers,
        answers: null,
        currentQuestion: null
    };

    if (room.currentRound >= room.maxRounds) {
        updates.status = 'finished';
    } else {
        updates.currentRound = room.currentRound + 1;
    }

    roomRef.update(updates).then(() => {
        window.calculating = false;
        $("input").val("");
        $("input").prop("disabled", false);
        $("#submitBtn").prop("disabled", false);
    });
}

loadRoom();
</script>
</body>
</html>