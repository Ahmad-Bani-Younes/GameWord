<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ¯ ØºØ±ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
body{background:linear-gradient(135deg,#f093fb,#f5576c);min-height:100vh;padding:20px;font-family:'Segoe UI',sans-serif}
.game-box{max-width:900px;margin:0 auto;background:#fff;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
h2{text-align:center;color:#f5576c;font-size:28px;margin-bottom:10px}
.room-info{text-align:center;margin-bottom:20px;padding:15px;background:#f8f9fa;border-radius:8px}
.round-indicator{background:#6c757d;color:#fff;padding:8px 15px;border-radius:20px;font-size:14px;font-weight:600;display:inline-block;margin:10px 0}
.leaderboard{margin:20px 0}
.leaderboard-title{font-size:20px;font-weight:700;margin-bottom:15px;text-align:center}
.player-row{display:flex;align-items:center;padding:12px;margin-bottom:10px;background:#f8f9fa;border-radius:10px;transition:all .3s}
.player-row:hover{transform:translateX(-5px)}
.player-row.me{background:linear-gradient(135deg,#f093fb15,#f5576c15);border:2px solid #f5576c}
.player-rank{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;margin-left:15px}
.player-rank.gold{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#8b6914}
.player-rank.silver{background:linear-gradient(135deg,#c0c0c0,#e8e8e8);color:#4a4a4a}
.player-rank.bronze{background:linear-gradient(135deg,#cd7f32,#e3a857);color:#5c3d1f}
.player-rank.normal{background:#dee2e6;color:#333}
.player-name{flex:1;font-weight:600;font-size:16px}
.player-score{font-size:24px;font-weight:700;color:#f5576c}
.player-status{font-size:12px;padding:4px 10px;border-radius:12px;margin-right:10px}
.player-status.waiting{background:#fff3cd;color:#856404}
.player-status.answered{background:#d4edda;color:#155724}
.challenge-box{background:linear-gradient(135deg,#667eea,#764ba2);padding:30px;border-radius:15px;margin:20px 0;color:#fff;text-align:center}
.letter{font-size:80px;font-weight:700;margin:10px 0}
.category{font-size:20px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:20px 0}
.input-group label{display:block;margin-bottom:5px;font-weight:600}
input[type=text]{width:100%;padding:12px;font-size:16px;border:2px solid #ddd;border-radius:8px}
input:focus{border-color:#f5576c;outline:0}
input:disabled{background:#f0f0f0}
button{width:100%;padding:15px;background:#f5576c;color:#fff;border:0;border-radius:8px;font-size:18px;font-weight:600;cursor:pointer;margin-top:15px}
button:hover:not(:disabled){background:#e04658}
button:disabled{background:#ccc;cursor:not-allowed}
button.secondary{background:#6c757d}
button.start{background:#28a745;max-width:300px;margin:20px auto;display:block}
.waiting-message{text-align:center;padding:40px;background:#fff3cd;border-radius:10px;margin:20px 0}
@media(max-width:600px){.form-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="game-box">
<h2>ğŸ¯ ØºØ±ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</h2>
<div class="room-info">
<h3 id="roomName">ØºØ±ÙØ© Ø§Ù„Ù„Ø¹Ø¨</h3>
<div class="round-indicator" id="roundIndicator">Ø§Ù„Ø¬ÙˆÙ„Ø© 0 / 5</div>
</div>
<div class="leaderboard">
<div class="leaderboard-title">ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
<div id="leaderboardList"></div>
</div>
<div id="gameArea" style="display:none">
<div class="challenge-box">
<div class="letter" id="letterBox">ØŸ</div>
<div class="category" id="categoryBox">Ø§Ù†ØªØ¸Ø±...</div>
</div>
<div class="form-grid">
<div class="input-group"><label>ğŸ‘¦ Ø§Ø³Ù… ÙˆÙ„Ø¯</label><input type="text" id="boyName" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯"></div>
<div class="input-group"><label>ğŸ‘§ Ø§Ø³Ù… Ø¨Ù†Øª</label><input type="text" id="girlName" placeholder="Ù…Ø«Ø§Ù„: Ø¢ÙŠØ©"></div>
<div class="input-group"><label>ğŸ¦ Ø­ÙŠÙˆØ§Ù†</label><input type="text" id="animal" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø³Ø¯"></div>
<div class="input-group"><label>ğŸŒ³ Ù†Ø¨Ø§Øª</label><input type="text" id="plant" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø±Ø²"></div>
<div class="input-group"><label>ğŸº Ø¬Ù…Ø§Ø¯</label><input type="text" id="object" placeholder="Ù…Ø«Ø§Ù„: Ø¥Ø¨Ø±Ø©"></div>
<div class="input-group"><label>ğŸŒ Ø¨Ù„Ø§Ø¯</label><input type="text" id="country" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø£Ø±Ø¯Ù†"></div>
</div>
<button id="submitBtn" onclick="submitAnswers()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>
</div>
<div id="waitingArea" class="waiting-message">
<h3>â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ù†Ø´Ø¦ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©...</h3>
<button id="startBtn" class="start" onclick="startGame()" style="display:none">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>
<button class="secondary" onclick="location.href='rooms.html'">Ø±Ø¬ÙˆØ¹ Ù„Ù„ØºØ±Ù</button>
</div>
<script>
const ROOMS_URL="https://6914f7e23746c71fe04a2ac4.mockapi.io/rooms";
const LETTERS=['Ø§','Ø¨','Øª','Ø¬','Ø­','Ø®','Ø¯','Ø±','Ø²','Ø³','Ø´','Øµ','Ø¹','Ù','Ù‚','Ùƒ','Ù„','Ù…','Ù†','Ù‡','Ùˆ','ÙŠ'];
const VALID={'Ø§':{boyNames:['Ø£Ø­Ù…Ø¯','Ø£Ù…ÙŠØ±','Ø£ÙŠÙ…Ù†','Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…'],girlNames:['Ø¢ÙŠØ©','Ø£Ù…Ù„','Ø¥ÙŠÙ…Ø§Ù†','Ø£Ø³Ù…Ø§Ø¡'],animals:['Ø£Ø³Ø¯','Ø£Ø±Ù†Ø¨'],plants:['Ø£Ø±Ø²','Ø£Ù†Ø§Ù†Ø§Ø³'],objects:['Ø¥Ø¨Ø±Ø©','Ø£Ø±ÙŠÙƒØ©'],countries:['Ø§Ù„Ø£Ø±Ø¯Ù†','Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª','Ø£Ù…Ø±ÙŠÙƒØ§']},'Ù…':{boyNames:['Ù…Ø­Ù…Ø¯','Ù…Ø­Ù…ÙˆØ¯','Ù…ØµØ·ÙÙ‰','Ù…Ø¹Ø§Ø°'],girlNames:['Ù…Ø±ÙŠÙ…','Ù…Ù„Ùƒ','Ù…Ù†Ù‰','Ù…ÙŠØ±Ø§'],animals:['Ù…Ø§Ø¹Ø²','Ù…Ù‡Ø§'],plants:['Ù…ÙˆØ²','Ù…Ø§Ù†Ø¬Ùˆ'],objects:['Ù…ÙØªØ§Ø­','Ù…ÙƒØªØ¨'],countries:['Ù…ØµØ±','Ø§Ù„Ù…ØºØ±Ø¨']},'Ø³':{boyNames:['Ø³Ø§Ù…ÙŠ','Ø³Ø¹ÙŠØ¯','Ø³Ø§Ù„Ù…'],girlNames:['Ø³Ø§Ø±Ø©','Ø³Ù„Ù…Ù‰','Ø³Ù†Ø§Ø¡'],animals:['Ø³Ù…ÙƒØ©','Ø³Ù„Ø­ÙØ§Ø©'],plants:['Ø³Ø¨Ø§Ù†Ø®'],objects:['Ø³Ø±ÙŠØ±','Ø³ÙŠØ§Ø±Ø©','Ø³Ø§Ø¹Ø©'],countries:['Ø³ÙˆØ±ÙŠØ§','Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©']}};
let me=JSON.parse(localStorage.getItem("user"));
if(!me)location.href="login.html";
let roomId=new URLSearchParams(location.search).get("room"),room=null;
function generateChallenge(){let l=LETTERS[Math.floor(Math.random()*LETTERS.length)];return{letter:l,category:`Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø§Øª ØªØ¨Ø¯Ø£ Ø¨Ø­Ø±Ù: ${l}`}}
function checkAnswer(l,a,t){if(!a||!a.trim())return null;a=a.trim();if(!a.startsWith(l))return false;if(VALID[l]){let v=VALID[l][t]||[];return v.includes(a)}return false}
function loadRoom(){$.get(ROOMS_URL+"/"+roomId,d=>{room=d;$("#roomName").text(room.name);$("#roundIndicator").text(`Ø§Ù„Ø¬ÙˆÙ„Ø© ${room.currentRound||0} / ${room.maxRounds}`);room.players.sort((a,b)=>(b.score||0)-(a.score||0));displayLeaderboard();if(room.status==='waiting'&&room.creatorId===String(me.id))$("#startBtn").show();if(room.status==='waiting'){$("#waitingArea").show();$("#gameArea").hide()}else if(room.status==='playing'){$("#waitingArea").hide();$("#gameArea").show();if(!room.currentQuestion){if(room.creatorId===String(me.id)){let c=generateChallenge();room.currentQuestion=c;room.answers={};saveRoom()}}else displayChallenge()}else if(room.status==='finished')location.href="room-results.html?room="+roomId})}
function displayLeaderboard(){let c=$("#leaderboardList").html("");room.players.forEach((p,i)=>{let r=i+1,rc='normal',t='';if(r===1){rc='gold';t='ğŸ‘‘'}else if(r===2){rc='silver';t='ğŸ¥ˆ'}else if(r===3){rc='bronze';t='ğŸ¥‰'}let isMe=p.id===String(me.id),row=isMe?'player-row me':'player-row',st='';if(room.status==='playing'&&room.answers){if(room.answers[p.id])st='<span class="player-status answered">âœ… Ø£Ø¬Ø§Ø¨</span>';else st='<span class="player-status waiting">â³ ÙŠÙ†ØªØ¸Ø±</span>'}c.append(`<div class="${row}"><div class="player-rank ${rc}">${t||r}</div><div class="player-name">${p.username}${isMe?' (Ø£Ù†Øª)':''}</div>${st}<div class="player-score">${p.score||0}</div></div>`)})}
function startGame(){if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ"))return;room.status='playing';room.currentRound=1;let c=generateChallenge();room.currentQuestion=c;room.answers={};saveRoom()}
function displayChallenge(){if(!room.currentQuestion)return;$("#letterBox").text(room.currentQuestion.letter);$("#categoryBox").text(room.currentQuestion.category);if(room.answers&&room.answers[String(me.id)]){$("input").prop("disabled",true);$("#submitBtn").prop("disabled",true)}else{$("input").prop("disabled",false);$("#submitBtn").prop("disabled",false)}}
function submitAnswers(){let a={boyName:$("#boyName").val().trim(),girlName:$("#girlName").val().trim(),animal:$("#animal").val().trim(),plant:$("#plant").val().trim(),object:$("#object").val().trim(),country:$("#country").val().trim()};room.answers=room.answers||{};room.answers[String(me.id)]={answers:a,time:Date.now()};$("input").prop("disabled",true);$("#submitBtn").prop("disabled",true);saveRoom(checkAllAnswered)}
function checkAllAnswered(){setTimeout(()=>{$.get(ROOMS_URL+"/"+roomId,d=>{room=d;if(!room.answers)return;let all=room.players.every(p=>room.answers[p.id]);if(all&&room.creatorId===String(me.id))calculateScores()})},1000)}
function calculateScores(){let l=room.currentQuestion.letter,cats=[{key:'boyName',type:'boyNames'},{key:'girlName',type:'girlNames'},{key:'animal',type:'animals'},{key:'plant',type:'plants'},{key:'object',type:'objects'},{key:'country',type:'countries'}],scores={},fastest={};room.players.forEach(p=>{let pd=room.answers[p.id];if(!pd)return;let sc=0;cats.forEach(c=>{let ans=pd.answers[c.key],cor=checkAnswer(l,ans,c.type);if(cor===true){sc++;if(!fastest[c.key]||pd.time<fastest[c.key].time)fastest[c.key]={playerId:p.id,time:pd.time}}});scores[p.id]=sc});Object.values(fastest).forEach(f=>{if(f&&scores[f.playerId]>0)scores[f.playerId]+=1});room.players.forEach(p=>p.score=(p.score||0)+(scores[p.id]||0));if(room.currentRound>=room.maxRounds){room.status='finished';room.currentQuestion=null;room.answers={}}else{room.currentRound+=1;room.currentQuestion=null;room.answers={}}saveRoom(()=>{if(room.status==='finished')location.href="room-results.html?room="+roomId;else{setTimeout(()=>{$.get(ROOMS_URL+"/"+roomId,ur=>{room=ur;if(!room.currentQuestion&&room.creatorId===String(me.id)){let c=generateChallenge();room.currentQuestion=c;room.answers={};saveRoom()}})},1000)}})}
function saveRoom(cb){$.ajax({url:ROOMS_URL+"/"+roomId,method:"PUT",contentType:"application/json",data:JSON.stringify(room),success:()=>{if(cb)cb()}})}
setInterval(()=>{if(!room||room.status!=='finished')loadRoom()},2000);
loadRoom();
</script>
</body>
</html>